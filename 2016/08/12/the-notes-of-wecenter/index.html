<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <meta http-equiv="X-UA-Compatible" content="IE=edge" >
  <title>wecenter学习笔记 | 技术之路</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="wecenter&amp;#x662F;&amp;#x4E00;&amp;#x4E2A;&amp;#x8F7B;&amp;#x91CF;&amp;#x7EA7;&amp;#x7684;&amp;#x95EE;&amp;#x7B54;&amp;#x793E;&amp;#x533A;&amp;#x7684;&amp;#x5F00;&amp;#x6E90;&amp;#x5E94;&amp;#x7528;&amp;#x4F7F;&amp;#x7528;&amp;#x79C1;&amp;#x6709;&amp;#x7684;&amp;#x6388;&amp;#x6743;&amp;#x534F">
<meta property="og:type" content="article">
<meta property="og:title" content="wecenter学习笔记">
<meta property="og:url" content="http://yungoo.github.io/2016/08/12/the-notes-of-wecenter/index.html">
<meta property="og:site_name" content="技术之路">
<meta property="og:description" content="wecenter&amp;#x662F;&amp;#x4E00;&amp;#x4E2A;&amp;#x8F7B;&amp;#x91CF;&amp;#x7EA7;&amp;#x7684;&amp;#x95EE;&amp;#x7B54;&amp;#x793E;&amp;#x533A;&amp;#x7684;&amp;#x5F00;&amp;#x6E90;&amp;#x5E94;&amp;#x7528;&amp;#x4F7F;&amp;#x7528;&amp;#x79C1;&amp;#x6709;&amp;#x7684;&amp;#x6388;&amp;#x6743;&amp;#x534F">
<meta property="og:updated_time" content="2016-08-12T03:09:00.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="wecenter学习笔记">
<meta name="twitter:description" content="wecenter&amp;#x662F;&amp;#x4E00;&amp;#x4E2A;&amp;#x8F7B;&amp;#x91CF;&amp;#x7EA7;&amp;#x7684;&amp;#x95EE;&amp;#x7B54;&amp;#x793E;&amp;#x533A;&amp;#x7684;&amp;#x5F00;&amp;#x6E90;&amp;#x5E94;&amp;#x7528;&amp;#x4F7F;&amp;#x7528;&amp;#x79C1;&amp;#x6709;&amp;#x7684;&amp;#x6388;&amp;#x6743;&amp;#x534F">
  
    <link rel="alternative" href="/atom.xml" title="技术之路" type="application/atom+xml">
  
  
    <link rel="icon" href="//favicon.png">
  
  <link rel="stylesheet" href="/css/style.css">
</head>

<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			<img lazy-src="0" class="js-avatar">
			
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/">haiyang</a></h1>
		</hgroup>

		

		
			<div class="switch-btn">
				<div class="icon">
					<div class="icon-ctn">
						<div class="icon-wrap icon-house" data-idx="0">
							<div class="birdhouse"></div>
							<div class="birdhouse_holes"></div>
						</div>
						<div class="icon-wrap icon-ribbon hide" data-idx="1">
							<div class="ribbon"></div>
						</div>
						
						
						<div class="icon-wrap icon-me hide" data-idx="3">
							<div class="user"></div>
							<div class="shoulder"></div>
						</div>
						
					</div>
					
				</div>
				<div class="tips-box hide">
					<div class="tips-arrow"></div>
					<ul class="tips-inner">
						<li>Menu</li>
						<li>Tags</li>
						
						
						<li>Über</li>
						
					</ul>
				</div>
			</div>
		

		<div class="switch-area">
			<div class="switch-wrap">
				<section class="switch-part switch-part1">
					<nav class="header-menu">
						<ul>
						
							<li><a href="/">主页</a></li>
				        
							<li><a href="/archives">所有文章</a></li>
				        
						</ul>
					</nav>
					<nav class="header-nav">
						<div class="social">
							
								<a class="github" target="_blank" href="https://github.com/yungoo" title="github">github</a>
					        
								<a class="weibo" target="_blank" href="https://weibo.com/imhaiyang" title="weibo">weibo</a>
					        
						</div>
					</nav>
				</section>
				
				
				<section class="switch-part switch-part2">
					<div class="widget tagcloud" id="js-tagcloud">
						<a href="/tags/java/" style="font-size: 10px;">java</a> <a href="/tags/maching-learning/" style="font-size: 10px;">maching-learning</a> <a href="/tags/maching-learning-python-decision-tree/" style="font-size: 10px;">maching-learning python decision-tree</a> <a href="/tags/php-wecenter-notes/" style="font-size: 10px;">php wecenter notes</a> <a href="/tags/raft-algorithm-distribute-system/" style="font-size: 10px;">raft algorithm distribute-system</a> <a href="/tags/raft-plan/" style="font-size: 10px;">raft plan</a>
					</div>
				</section>
				
				
				

				
				
				<section class="switch-part switch-part3">
				
					<div id="js-aboutme">我是谁，我从哪里来，我到哪里去？我就是我，是颜色不一样的吃货…</div>
				</section>
				
			</div>
		</div>
	</header>				
</div>

    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"></div>
  		<h1 class="header-author js-mobile-header hide">haiyang</h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
				
					<img lazy-src="0" class="js-avatar">
				
			</div>
			<hgroup>
			  <h1 class="header-author">haiyang</h1>
			</hgroup>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">主页</a></li>
		        
					<li><a href="/archives">所有文章</a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="https://github.com/yungoo" title="github">github</a>
			        
						<a class="weibo" target="_blank" href="https://weibo.com/imhaiyang" title="weibo">weibo</a>
			        
				</div>
			</nav>
		</header>				
	</div>
</nav>

      <div class="body-wrap"><article id="post-the-notes-of-wecenter" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/08/12/the-notes-of-wecenter/" class="article-date">
  	<time datetime="2016-08-12T03:08:01.000Z" itemprop="datePublished">2016-08-12</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      wecenter学习笔记
    </h1>
  

      </header>
      
      <div class="article-info article-info-post">
        
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/php-wecenter-notes/">php wecenter notes</a></li></ul>
	</div>

        

        <div class="clearfix"></div>
      </div>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <blockquote>
<p>wecenter&#x662F;&#x4E00;&#x4E2A;&#x8F7B;&#x91CF;&#x7EA7;&#x7684;&#x95EE;&#x7B54;&#x793E;&#x533A;&#x7684;&#x5F00;&#x6E90;&#x5E94;&#x7528;<br>&#x4F7F;&#x7528;&#x79C1;&#x6709;&#x7684;&#x6388;&#x6743;&#x534F;&#x8BAE;&#xFF0C;&#x5546;&#x4E1A;&#x7528;&#x9014;&#x5FC5;&#x987B;&#x4ED8;&#x8D39;&#x624D;&#x80FD;&#x4F7F;&#x7528;&#xFF0C;&#x4E2A;&#x4EBA;&#x975E;&#x5546;&#x4E1A;&#x7528;&#x9014;&#x65E0;&#x9700;&#x6388;&#x6743;&#x3002;<br>&#x5B98;&#x65B9;&#x4E3B;&#x9875;&#xFF1A; <a href="http://wecenter.com" target="_blank" rel="external">http://wecenter.com</a></p>
</blockquote>
<p>&#x5728;&#x5B66;&#x4E60;&#x8FC7;&#x7A0B;&#x4E2D;&#xFF0C;&#x5B58;&#x4E0B;&#x8BE5;&#x7B14;&#x8BB0;&#xFF0C;&#x4EC5;&#x53C2;&#x8003;&#x5176;&#x5B9E;&#x73B0;&#x65B9;&#x6CD5;&#x548C;&#x539F;&#x7406;&#xFF0C;&#x5982;&#x9700;&#x76F4;&#x63A5;&#x4F7F;&#x7528;wecenter&#x6D89;&#x53CA;&#x7248;&#x6743;&#x90E8;&#x5206;&#x6E90;&#x7801;&#x8BF7;&#x83B7;&#x53D6;&#x6388;&#x6743;&#x540E;&#x518D;&#x4F7F;&#x7528;&#x3002;</p>
<h2 id="&#x6A21;&#x7248;&#x89C6;&#x56FE;&#x6E32;&#x67D3;&#x6846;&#x67B6;Savant3"><a href="#&#x6A21;&#x7248;&#x89C6;&#x56FE;&#x6E32;&#x67D3;&#x6846;&#x67B6;Savant3" class="headerlink" title="&#x6A21;&#x7248;&#x89C6;&#x56FE;&#x6E32;&#x67D3;&#x6846;&#x67B6;Savant3"></a>&#x6A21;&#x7248;&#x89C6;&#x56FE;&#x6E32;&#x67D3;&#x6846;&#x67B6;Savant3</h2><p>&#x6838;&#x5FC3;&#x4EE3;&#x7801;&#x5982;&#x4E0B;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div></pre></td><td class="code"><pre><div class="line">public function fetch($tpl = null)</div><div class="line">	{</div><div class="line">		// make sure we have a template source to work with</div><div class="line">		if (is_null($tpl)) {</div><div class="line">			$tpl = $this-&gt;__config[&apos;template&apos;];</div><div class="line">		}</div><div class="line">		</div><div class="line">		// get a path to the compiled template script</div><div class="line">		$result = $this-&gt;template($tpl);</div><div class="line">		</div><div class="line">		// did we get a path?</div><div class="line">		if (! $result || $this-&gt;isError($result)) {</div><div class="line">		</div><div class="line">			// no. return the error result.</div><div class="line">			return $result;</div><div class="line">			</div><div class="line">		} else {</div><div class="line">		</div><div class="line">			// yes.  execute the template script.  move the script-path</div><div class="line">			// out of the local scope, then clean up the local scope to</div><div class="line">			// avoid variable name conflicts.</div><div class="line">			$this-&gt;__config[&apos;fetch&apos;] = $result;</div><div class="line">			unset($result);</div><div class="line">			unset($tpl);</div><div class="line">			</div><div class="line">			// are we doing extraction?</div><div class="line">			if ($this-&gt;__config[&apos;extract&apos;]) {</div><div class="line">				// pull variables into the local scope.</div><div class="line">				extract(get_object_vars($this), EXTR_REFS);</div><div class="line">			}</div><div class="line">			</div><div class="line">			// buffer output so we can return it instead of displaying.</div><div class="line">			ob_start();</div><div class="line">			</div><div class="line">			// are we using filters?</div><div class="line">			if ($this-&gt;__config[&apos;filters&apos;]) {</div><div class="line">				// use a second buffer to apply filters. we used to set</div><div class="line">				// the ob_start() filter callback, but that would</div><div class="line">				// silence errors in the filters. Hendy Irawan provided</div><div class="line">				// the next three lines as a &quot;verbose&quot; fix.</div><div class="line">				ob_start();</div><div class="line">				include $this-&gt;__config[&apos;fetch&apos;];</div><div class="line">				echo $this-&gt;applyFilters(ob_get_clean());</div><div class="line">			} else {</div><div class="line">				// no filters being used.</div><div class="line">				include $this-&gt;__config[&apos;fetch&apos;];</div><div class="line">			}</div><div class="line">			</div><div class="line">			// reset the fetch script value, get the buffer, and return.</div><div class="line">			$this-&gt;__config[&apos;fetch&apos;] = null;</div><div class="line">			return ob_get_clean();</div><div class="line">		}</div><div class="line">	}</div></pre></td></tr></table></figure>
<p>&#x5206;&#x4E24;&#x6B65;:</p>
<ol>
<li><p>&#x5C06;assign&#x8BBE;&#x7F6E;&#x5230;Savant3&#x5B9E;&#x4F8B;&#x7684;&#x6210;&#x5458;&#x53D8;&#x91CF;&#x5BFC;&#x5165;&#x5230;&#x5F53;&#x524D;&#x7B26;&#x53F7;&#x8868;&#x4E2D;</p>
<figure class="highlight plain"><figcaption><span>EXTR_REFS);```</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">   </div><div class="line">2. &#x6267;&#x884C;&#x6A21;&#x7248;</div><div class="line">   ```include $this-&gt;__config[&apos;fetch&apos;];</div></pre></td></tr></table></figure>
</li>
</ol>
<h2 id="Zend-Session-&#x6846;&#x67B6;"><a href="#Zend-Session-&#x6846;&#x67B6;" class="headerlink" title="Zend Session &#x6846;&#x67B6;"></a>Zend Session &#x6846;&#x67B6;</h2><h3 id="PHP-runtime&#x5BF9;Session&#x7684;&#x652F;&#x6301;"><a href="#PHP-runtime&#x5BF9;Session&#x7684;&#x652F;&#x6301;" class="headerlink" title="PHP runtime&#x5BF9;Session&#x7684;&#x652F;&#x6301;"></a>PHP runtime&#x5BF9;Session&#x7684;&#x652F;&#x6301;</h3><ul>
<li>&#x542F;&#x52A8;&#x65B0;&#x4F1A;&#x8BDD;&#x6216;&#x8005;&#x91CD;&#x7528;&#x73B0;&#x6709;&#x4F1A;&#x8BDD;</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">bool session_start ([ array $options = [] ] )</div></pre></td></tr></table></figure>
<ul>
<li>&#x4F7F;&#x7528;&#x65B0;&#x751F;&#x6210;&#x7684;&#x4F1A;&#x8BDD; ID &#x66F4;&#x65B0;&#x73B0;&#x6709;&#x4F1A;&#x8BDD; ID</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">bool session_regenerate_id ([ bool $delete_old_session = false ] )</div></pre></td></tr></table></figure>
<ul>
<li>&#x8BBE;&#x7F6E;&#x7528;&#x6237;&#x81EA;&#x5B9A;&#x4E49;&#x4F1A;&#x8BDD;&#x5B58;&#x50A8;&#x51FD;&#x6570;</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">bool session_set_save_handler ( callable $open , callable $close , callable $read , callable $write , callable $destroy , callable $gc [, callable $create_sid ] )</div></pre></td></tr></table></figure>
<ul>
<li>&#x9500;&#x6BC1;&#x4E00;&#x4E2A;&#x4F1A;&#x8BDD;&#x4E2D;&#x7684;&#x5168;&#x90E8;&#x6570;&#x636E;</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">bool session_destroy ( void )</div></pre></td></tr></table></figure>
<ul>
<li>&#x4FDD;&#x5B58;Session&#x6570;&#x636E;&#x5E76;&#x7ED3;&#x675F;Session</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">void session_write_close ( void )</div></pre></td></tr></table></figure>
<ul>
<li>&#x8BBE;&#x7F6E;Cookie</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">bool setcookie ( string $name [, string $value = &quot;&quot; [, int $expire = 0 [, string $path = &quot;&quot; [, string $domain = &quot;&quot; [, bool $secure = false [, bool $httponly = false ]]]]]] )</div></pre></td></tr></table></figure>
<ul>
<li>&#x5176;&#x5B83;</li>
</ul>
<p><a href="http://php.net/manual/zh/ref.session.php" target="_blank" rel="external">PHP&#x624B;&#x518C;&#xFF0D;&#x51FD;&#x6570;&#x53C2;&#x8003;&#xFF0D;Session &#x51FD;&#x6570;</a></p>
<h3 id="&#x4EC0;&#x4E48;&#x662F;Session&#x547D;&#x540D;&#x7A7A;&#x95F4;"><a href="#&#x4EC0;&#x4E48;&#x662F;Session&#x547D;&#x540D;&#x7A7A;&#x95F4;" class="headerlink" title="&#x4EC0;&#x4E48;&#x662F;Session&#x547D;&#x540D;&#x7A7A;&#x95F4;"></a>&#x4EC0;&#x4E48;&#x662F;Session&#x547D;&#x540D;&#x7A7A;&#x95F4;</h3><p>Zend&#x4F7F;&#x7528;&#x547D;&#x540D;&#x7A7A;&#x95F4;&#x6765;&#x9694;&#x79BB;&#x4E0D;&#x540C;&#x7684;Session&#x6570;&#x636E;&#xFF0C;&#x5BF9;&#x5E94;&#x7C7B;<code>Zend_Session_Namespace</code>&#x3002;</p>
<p>&#x6570;&#x636E;&#x4ECD;&#x7136;&#x5B58;&#x653E;&#x5728;&#x5168;&#x5C40;&#x53D8;&#x91CF; $_SESSION&#x4E2D;&#xFF0C;&#x4E0D;&#x540C;&#x7684;&#x7A7A;&#x95F4;&#x7684;&#x6570;&#x636E;&#x5B58;&#x653E;&#x5230;&#x5982;&#x4E0B;&#x7684;&#x952E;&#x4E0B;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$_SESSION[&apos;namespace&apos;]</div></pre></td></tr></table></figure>
<h3 id="Session&#x6570;&#x636E;&#x6301;&#x4E45;&#x5316;"><a href="#Session&#x6570;&#x636E;&#x6301;&#x4E45;&#x5316;" class="headerlink" title="Session&#x6570;&#x636E;&#x6301;&#x4E45;&#x5316;"></a>Session&#x6570;&#x636E;&#x6301;&#x4E45;&#x5316;</h3><p>Zend Session&#x9ED8;&#x8BA4;&#x652F;&#x6301;&#x4E24;&#x79CD;&#x5B58;&#x50A8;&#x65B9;&#x5F0F;&#xFF1A;</p>
<ul>
<li>&#x5B58;&#x50A8;&#x5230;&#x6587;&#x4EF6;</li>
<li>&#x5B58;&#x50A8;&#x5230;&#x6570;&#x636E;&#x5E93;</li>
</ul>
<p>Zend Session&#x6307;&#x5B9A;&#x4E86;&#x89C4;&#x8303;&#x5316;&#x7684;&#x6301;&#x4E45;&#x5316;&#x63A5;&#x53E3;&#xFF0C;&#x5305;&#x62EC;&#xFF1A;</p>
<ul>
<li>open</li>
<li>close</li>
<li>read</li>
<li>write</li>
<li>destroy</li>
<li>gc</li>
</ul>
<p>&#x7EDF;&#x4E00;&#x901A;&#x8FC7;&#x5B9E;&#x73B0;&#x63A5;&#x53E3; <code>Zend_Session_SaveHandler_Interface</code> &#x6765;&#x5B9E;&#x73B0;&#x5B58;&#x50A8;&#x5230;&#x5206;&#x5E03;&#x5F0F;&#x7F13;&#x5B58;&#x3002;</p>
<p>&#x5E8F;&#x5217;&#x5316;session&#x6570;&#x636E;&#x5230;&#x6570;&#x636E;&#x8868;&#x4E2D;<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">Zend_Session::setSaveHandler(new Zend_Session_SaveHandler_DbTable(array(</div><div class="line">			    &apos;name&apos; 					=&gt; get_table(&apos;sessions&apos;),</div><div class="line">			    &apos;primary&apos;				=&gt; &apos;id&apos;,</div><div class="line">			    &apos;modifiedColumn&apos;		=&gt; &apos;modified&apos;,</div><div class="line">			    &apos;dataColumn&apos;			=&gt; &apos;data&apos;,</div><div class="line">			    &apos;lifetimeColumn&apos;		=&gt; &apos;lifetime&apos;,</div><div class="line">				//&apos;authIdentityColumn&apos;	=&gt; &apos;uid&apos;</div><div class="line">			)));</div></pre></td></tr></table></figure></p>
<p>&#x8868;&#x7ED3;&#x6784;&#x5927;&#x62B5;&#x5982;&#x4E0B;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">CREATE TABLE `aws_sessions` (</div><div class="line">  `id` varchar(32) NOT NULL COMMENT &apos;session id&apos;,</div><div class="line">  `modified` int(10) NOT NULL COMMENT &apos;&#x4FEE;&#x6539;&#x65F6;&#x95F4;&apos;,</div><div class="line">  `data` text NOT NULL COMMENT &apos;Session&#x6570;&#x636E;&apos;,</div><div class="line">  `lifetime` int(10) NOT NULL COMMENT &apos;&#x6709;&#x6548;&#x65F6;&#x95F4;&apos;,</div><div class="line">  PRIMARY KEY (`id`),</div><div class="line">  KEY `modified` (`modified`),</div><div class="line">  KEY `lifetime` (`lifetime`)</div><div class="line">) ENGINE=MyISAM DEFAULT CHARSET=utf8;</div></pre></td></tr></table></figure>
<p>&#x5B57;&#x6BB5;&#x540D;&#x53EF;&#x4EE5;&#x901A;&#x8FC7; <code>Zend_Session_SaveHandler_DbTable</code>&#x7684;&#x6784;&#x9020;&#x51FD;&#x6570;&#x53C2;&#x6570;&#x5B9A;&#x5236;</p>
<h3 id="&#x521B;&#x5EFA;&#x548C;&#x6062;&#x590D;Session"><a href="#&#x521B;&#x5EFA;&#x548C;&#x6062;&#x590D;Session" class="headerlink" title="&#x521B;&#x5EFA;&#x548C;&#x6062;&#x590D;Session"></a>&#x521B;&#x5EFA;&#x548C;&#x6062;&#x590D;Session</h3><p>&#x901A;&#x8FC7;&#x5982;&#x4E0B;&#x65B9;&#x5F0F;&#x6765;&#x542F;&#x52A8;Session</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">Zend_Session::start();</div><div class="line"></div><div class="line">self::$session = new Zend_Session_Namespace(G_COOKIE_PREFIX . &apos;_Anwsion&apos;);</div></pre></td></tr></table></figure>
<h3 id="&#x7EC8;&#x6B62;Session&#x548C;Session&#x7684;&#x6709;&#x6548;&#x671F;"><a href="#&#x7EC8;&#x6B62;Session&#x548C;Session&#x7684;&#x6709;&#x6548;&#x671F;" class="headerlink" title="&#x7EC8;&#x6B62;Session&#x548C;Session&#x7684;&#x6709;&#x6548;&#x671F;"></a>&#x7EC8;&#x6B62;Session&#x548C;Session&#x7684;&#x6709;&#x6548;&#x671F;</h3><p>&#x4E00;&#x822C;&#x4E0D;&#x9700;&#x8981;&#x4E3B;&#x52A8;&#x8C03;&#x7528;<code>writeClose</code>&#xFF0C; Session&#x6570;&#x636E;&#x4F1A;&#x5728;&#x811A;&#x672C;&#x6267;&#x884C;&#x5B8C;&#x81EA;&#x52A8;&#x4FDD;&#x5B58;&#x3002;</p>
<p>Session&#x7684;&#x6709;&#x6548;&#x671F;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x4FEE;&#x6539;<code>php.ini</code>&#x7684;<code>[session]</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">; After this number of seconds, stored data will be seen as &apos;garbage&apos; and</div><div class="line">; cleaned up by the garbage collection process.</div><div class="line">; http://php.net/session.gc-maxlifetime</div><div class="line">session.gc_maxlifetime = 1440</div></pre></td></tr></table></figure>
<h3 id="rememberme"><a href="#rememberme" class="headerlink" title="rememberme"></a>rememberme</h3><p>&#x8BBE;&#x7F6E;cookied&#x7684;&#x5931;&#x6548;&#x65F6;&#x95F4;&#x6765;&#x5B9E;&#x73B0;remember-me</p>
<blockquote>
<p>system/Zend/Session.php#rememberUntil</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">$cookieParams = session_get_cookie_params();</div><div class="line"></div><div class="line">session_set_cookie_params(</div><div class="line">    $seconds,</div><div class="line">    $cookieParams[&apos;path&apos;],</div><div class="line">    $cookieParams[&apos;domain&apos;],</div><div class="line">    $cookieParams[&apos;secure&apos;]</div><div class="line">    );</div></pre></td></tr></table></figure>
<h3 id="&#x7528;&#x6237;&#x767B;&#x9646;&#x5224;&#x65AD;"><a href="#&#x7528;&#x6237;&#x767B;&#x9646;&#x5224;&#x65AD;" class="headerlink" title="&#x7528;&#x6237;&#x767B;&#x9646;&#x5224;&#x65AD;"></a>&#x7528;&#x6237;&#x767B;&#x9646;&#x5224;&#x65AD;</h3><p>&#x901A;&#x8FC7;&#x89E3;&#x5BC6;<code>_user_login</code>&#x7684;cookie&#x83B7;&#x53D6;&#x7528;&#x6237;&#x767B;&#x9646;&#x4FE1;&#x606F;&#xFF0C;&#x6765;&#x9A8C;&#x8BC1;&#x662F;&#x5426;&#x767B;&#x9646;</p>
<blockquote>
<p>system/core/user.php#get_info</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">if (! AWS_APP::session()-&gt;client_info AND $_COOKIE[G_COOKIE_PREFIX . &apos;_user_login&apos;])</div><div class="line">{</div><div class="line">	$auth_hash_key = md5(G_COOKIE_HASH_KEY . $_SERVER[&apos;HTTP_USER_AGENT&apos;]);</div><div class="line"></div><div class="line">	// &#x89E3;&#x7801; Cookie</div><div class="line">	$sso_user_login = json_decode(AWS_APP::crypt()-&gt;decode($_COOKIE[G_COOKIE_PREFIX . &apos;_user_login&apos;], $auth_hash_key), true);</div><div class="line"></div><div class="line">	if ($sso_user_login[&apos;user_name&apos;] AND $sso_user_login[&apos;password&apos;] AND $sso_user_login[&apos;uid&apos;])</div><div class="line">	{</div><div class="line">		if ($user_info = AWS_APP::model(&apos;account&apos;)-&gt;check_hash_login($sso_user_login[&apos;user_name&apos;], $sso_user_login[&apos;password&apos;]))</div><div class="line">		{</div><div class="line">			AWS_APP::session()-&gt;client_info[&apos;__CLIENT_UID&apos;] = $user_info[&apos;uid&apos;];</div><div class="line">			AWS_APP::session()-&gt;client_info[&apos;__CLIENT_USER_NAME&apos;] = $user_info[&apos;user_name&apos;];</div><div class="line">			AWS_APP::session()-&gt;client_info[&apos;__CLIENT_PASSWORD&apos;] = $sso_user_login[&apos;password&apos;];</div><div class="line"></div><div class="line">			return true;</div><div class="line">		}</div><div class="line">	}</div><div class="line"></div><div class="line">	HTTP::set_cookie(&apos;_user_login&apos;, &apos;&apos;, null, &apos;/&apos;, null, false, true);</div><div class="line"></div><div class="line">	return false;</div><div class="line">}</div></pre></td></tr></table></figure>
<p>&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#xFF0C;&#x5224;&#x65AD;&#x7528;&#x6237;&#x662F;&#x5426;&#x767B;&#x9646;&#x8FC7;&#x4F9D;&#x8D56;&#x7684;&#x5E76;&#x4E0D;&#x662F;session&#xFF0C;&#x800C;&#x662F;&#x5B58;&#x50A8;&#x7684;cookie&#x4E2D;&#x7684;&#x7528;&#x6237;&#x4FE1;&#x606F;&#x3002;&#x5982;&#x679C;&#x7528;&#x6237;&#x5BC6;&#x7801;&#x6216;&#x7528;&#x6237;&#x540D;&#x4FEE;&#x6539;&#x4E86;&#xFF0C;&#x767B;&#x9646;&#x4FE1;&#x606F;&#x4E5F;&#x4F1A;&#x5931;&#x6548;&#xFF0C;&#x7B26;&#x5408;&#x8BBE;&#x8BA1;&#x8981;&#x6C42;&#x3002;</p>
<p>&#x767B;&#x9646;&#x6210;&#x529F;&#x540E;&#x8FD8;&#x4F1A;&#x5C06;&#x767B;&#x9646;&#x7684;&#x7528;&#x6237;&#x4FE1;&#x606F;&#x5B58;&#x5165;Session Data&#xFF08;&#x6700;&#x7EC8;&#x4F1A;&#x7CFB;&#x5217;&#x5316;&#x5B58;&#x50A8;&#xFF09;&#xFF0C;&#x5982;&#x679C;Session&#x6709;&#x6548;&#xFF0C;&#x5373;&#x4F7F;_user_login&#x7684;Cookied&#x65E0;&#x6548;&#xFF0C;&#x7528;&#x6237;&#x4E5F;&#x53EF;&#x7B97;&#x662F;&#x5DF2;&#x767B;&#x9646;&#x7684;&#x3002;</p>
<h3 id="URL&#x6539;&#x5199;"><a href="#URL&#x6539;&#x5199;" class="headerlink" title="URL&#x6539;&#x5199;"></a>URL&#x6539;&#x5199;</h3><p>&#x901A;&#x5E38;&#xFF0C;wecenter&#x7684;&#x5730;&#x5740;&#x5982;&#x4E0B;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">http://host/?/article/8?id=1&amp;wtf=other</div></pre></td></tr></table></figure>
<p>&#x5176;&#x4E2D;IndexScript&#xFF08;<code>?/</code>&#xFF09;&#x90E8;&#x5206;&#x53EF;&#x4EE5;&#x4FEE;&#x6539;</p>
<blockquote>
<p>system/config.inc.php</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">25 define(&apos;G_INDEX_SCRIPT&apos;, &apos;?/&apos;);</div></pre></td></tr></table></figure>
<p>&#x4E2D;&#x95F4;&#x90E8;&#x5206;&#x79F0;&#x4E3A;<code>&#x52A8;&#x4F5C;</code>&#xFF0C;&#x683C;&#x5F0F;&#x5982; <code>/&#x6A21;&#x5757;&#x540D;/&#x63A7;&#x5236;&#x5668;/&#x52A8;&#x4F5C;/ID</code>&#xFF0C;&#x5177;&#x4F53;&#x89C4;&#x5219;&#x4E3A;</p>
<ul>
<li><p>&#x5982;&#x679C;&#x4F7F;&#x7528; /&#x6A21;&#x5757;&#x540D;/&#x63A7;&#x5236;&#x5668;/&#x52A8;&#x4F5C;/ID &#x683C;&#x5F0F; Query string &#x7684;&#x4F7F;&#x7528;&#x53EF;&#x4EE5;&#x53C2;&#x7167; &#x517C;&#x5BB9;&#x6027;&#x7684;&#x652F;&#x6301;</p>
</li>
<li><p>&#x5982;&#x679C;&#x52A8;&#x4F5C;&#x5728; main &#x63A7;&#x5236;&#x5668;&#x4E2D;&#x53EF;&#x4EE5;&#x7701;&#x7565;, &#x4F8B;: account/main/login/ &#x7B49;&#x540C;&#x4E8E; account/login/</p>
</li>
<li><p>&#x5982;&#x679C;&#x52A8;&#x4F5C;&#x540D;&#x4E3A; index &#x53EF;&#x4EE5;&#x7701;&#x7565;,  &#x4F8B;: account/login/index/ &#x7B49;&#x540C;&#x4E8E; account/login/</p>
</li>
</ul>
<p>query string&#x53C2;&#x6570;&#x4E5F;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x89C4;&#x5219;&#x6539;&#x5199;</p>
<p>WeCenter &#x7684;&#x67E5;&#x8BE2;&#x5B57;&#x7B26;&#x4E32;&#x4E3A;&#x4F7F;&#x7528; __ &#x5206;&#x9694;&#x53C2;&#x6570;, &#x4F7F;&#x7528; &#x2013; &#x4E3A;&#x53C2;&#x6570;&#x8D4B;&#x503C;, &#x5728;&#x7A0B;&#x5E8F;&#x4E2D;&#x76F4;&#x63A5;&#x4F7F;&#x7528; $_GET &#x53D6;&#x51FA;&#x5185;&#x5BB9;<br>&#x5E38;&#x89C4;&#x7684;: </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">account/login/?return_url=1&amp;callback=2</div></pre></td></tr></table></figure>
<p>WeCenter &#x7684;: </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">account/login/return_url-1__callback-2</div></pre></td></tr></table></figure>
<p>&#x517C;&#x5BB9;&#x6027;&#x652F;&#x6301;</p>
<p>&#x4E0B;&#x9762;&#x7684;&#x51E0;&#x79CD; URL &#x5F62;&#x5F0F;&#x5728;&#x7A0B;&#x5E8F;&#x4E2D;&#x90FD;&#x662F;&#x88AB;&#x652F;&#x6301;&#x7684;:</p>
<p><a href="http://domian/index.php?/question/id-320__column-log__source-doc" target="_blank" rel="external">http://domian/index.php?/question/id-320__column-log__source-doc</a></p>
<p><a href="http://domian/index.php?/question/320?column=log&amp;source=doc" target="_blank" rel="external">http://domian/index.php?/question/320?column=log&amp;source=doc</a></p>
<p><a href="http://domian/index.php?/question/?id=320&amp;column=log&amp;source=doc" target="_blank" rel="external">http://domian/index.php?/question/?id=320&amp;column=log&amp;source=doc</a></p>
<p><a href="http://domian/index.php?/question/320?column-log__source-doc" target="_blank" rel="external">http://domian/index.php?/question/320?column-log__source-doc</a></p>
<p><a href="http://domian/index.php?/question/320&amp;column-log__source-doc" target="_blank" rel="external">http://domian/index.php?/question/320&amp;column-log__source-doc</a></p>
<blockquote>
<p>&#x6CE8;&#x610F;&#xFF1A;index.php&#x662F;&#x552F;&#x4E00;&#x7684;&#x5165;&#x53E3;&#xFF0C;action&#x53EA;&#x80FD;&#x901A;&#x8FC7;query string&#x4F20;&#x5165;&#xFF0C;&#x5E76;&#x901A;&#x8FC7;&#x81EA;&#x5B9A;&#x4E49;&#x7684;&#x8DEF;&#x7531;&#x89C4;&#x5219;&#x5B9E;&#x73B0;url&#x5230;action&#x7684;&#x6620;&#x5C04;&#xFF0C;&#x5177;&#x4F53;rewrite&#x7684;&#x5B9E;&#x73B0;&#x53C2;&#x7167;</p>
<p>system/core/url.php</p>
</blockquote>
<p>URL&#x6700;&#x7EC8;&#x88AB;&#x89E3;&#x6790;&#x4E3A;</p>
<ul>
<li>app_dir</li>
<li>controller</li>
<li>action</li>
<li>$_GET</li>
</ul>
<h2 id="action&#x8DEF;&#x7531;"><a href="#action&#x8DEF;&#x7531;" class="headerlink" title="action&#x8DEF;&#x7531;"></a>action&#x8DEF;&#x7531;</h2><p><strong> &#x521B;&#x5EFA;controller </strong></p>
<blockquote>
<p>system/aws_app.inc.php</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line">public static function create_controller($controller, $app_dir)</div><div class="line">	{</div><div class="line">		if ($app_dir == &apos;&apos; OR trim($controller, &apos;/&apos;) === &apos;&apos;)</div><div class="line">		{</div><div class="line">			return false;</div><div class="line">		}</div><div class="line"></div><div class="line">		$class_file = $app_dir . $controller . &apos;.php&apos;;</div><div class="line"></div><div class="line">		$controller_class = str_replace(&apos;/&apos;, &apos;_&apos;, $controller);</div><div class="line"></div><div class="line">		if (! file_exists($class_file))</div><div class="line">		{</div><div class="line">			return false;</div><div class="line">		}</div><div class="line"></div><div class="line">		if (! class_exists($controller_class, false))</div><div class="line">		{</div><div class="line">			require_once $class_file;</div><div class="line">		}</div><div class="line"></div><div class="line">		// &#x89E3;&#x6790;&#x8DEF;&#x7531;&#x67E5;&#x8BE2;&#x53C2;&#x6570;</div><div class="line">		load_class(&apos;core_uri&apos;)-&gt;parse_args();</div><div class="line"></div><div class="line">		if (class_exists($controller_class, false))</div><div class="line">		{</div><div class="line">			return new $controller_class();</div><div class="line">		}</div><div class="line"></div><div class="line">		return false;</div><div class="line">	}</div></pre></td></tr></table></figure>
<p><strong> &#x6267;&#x884C;action method </strong></p>
<blockquote>
<p>system/aws_app.inc.php#run</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">$action_method = load_class(&apos;core_uri&apos;)-&gt;action . &apos;_action&apos;;</div><div class="line"></div><div class="line">// &#x5224;&#x65AD;</div><div class="line">if (! is_object($handle_controller) OR ! method_exists($handle_controller, $action_method))</div><div class="line">{</div><div class="line">	HTTP::error_404();</div><div class="line">}</div><div class="line"></div><div class="line">...</div><div class="line"></div><div class="line">// &#x6267;&#x884C;</div><div class="line">if (!$_GET[&apos;id&apos;] AND method_exists($handle_controller, load_class(&apos;core_uri&apos;)-&gt;action . &apos;_square_action&apos;))</div><div class="line">{</div><div class="line">    $action_method = load_class(&apos;core_uri&apos;)-&gt;action . &apos;_square_action&apos;;</div><div class="line">}</div><div class="line"></div><div class="line">$handle_controller-&gt;$action_method();</div></pre></td></tr></table></figure>
<h2 id="Controller&#x8BBF;&#x95EE;&#x63A7;&#x5236;&#x5B9E;&#x73B0;&#x539F;&#x7406;"><a href="#Controller&#x8BBF;&#x95EE;&#x63A7;&#x5236;&#x5B9E;&#x73B0;&#x539F;&#x7406;" class="headerlink" title="Controller&#x8BBF;&#x95EE;&#x63A7;&#x5236;&#x5B9E;&#x73B0;&#x539F;&#x7406;"></a>Controller&#x8BBF;&#x95EE;&#x63A7;&#x5236;&#x5B9E;&#x73B0;&#x539F;&#x7406;</h2><p>&#x901A;&#x8FC7;&#x5728;Controller&#x7684;<code>get_access_rule</code>&#x6765;&#x8FD4;&#x56DE;&#x8BBF;&#x95EE;&#x63A7;&#x5236;&#x6743;&#x9650;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">public function get_access_rule()</div><div class="line">{</div><div class="line">	$rule_action[&apos;rule_type&apos;] = &apos;white&apos;;</div><div class="line"></div><div class="line">	$rule_action[&apos;actions&apos;][] = &apos;index&apos;;</div><div class="line">	$rule_action[&apos;actions&apos;][] = &apos;save_comment&apos;;</div><div class="line"></div><div class="line">	return $rule_action;</div><div class="line">}</div></pre></td></tr></table></figure>
<p>&#x5E94;&#x7528;&#x542F;&#x52A8;&#x65F6;&#x4F1A;&#x68C0;&#x67E5;action&#x662F;&#x5426;&#x5728;&#x767D;&#x540D;&#x5355;&#x6216;&#x8005;&#x9ED1;&#x540D;&#x5355;&#x4E2D;&#xFF0C;&#x4ECE;&#x800C;&#x5F15;&#x5BFC;&#x672A;&#x767B;&#x9646;&#x7684;&#x7528;&#x6237;&#x8FDB;&#x884C;&#x767B;&#x9646;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">// &#x5224;&#x65AD;&#x8BBF;&#x95EE;&#x89C4;&#x5219;&#x4F7F;&#x7528;&#x767D;&#x540D;&#x5355;&#x8FD8;&#x662F;&#x9ED1;&#x540D;&#x5355;, &#x9ED8;&#x8BA4;&#x4F7F;&#x7528;&#x9ED1;&#x540D;&#x5355;</div><div class="line">if ($access_rule)</div><div class="line">{</div><div class="line">	// &#x9ED1;&#x540D;&#x5355;, &#x9ED1;&#x540D;&#x5355;&#x4E2D;&#x7684;&#x68C0;&#x67E5; &apos;white&apos; &#x767D;&#x540D;&#x5355;,&#x767D;&#x540D;&#x5355;&#x4EE5;&#x5916;&#x7684;&#x68C0;&#x67E5; (&#x9ED8;&#x8BA4;&#x662F;&#x9ED1;&#x540D;&#x5355;&#x68C0;&#x67E5;)</div><div class="line">	if (isset($access_rule[&apos;rule_type&apos;]) AND $access_rule[&apos;rule_type&apos;] == &apos;white&apos;)</div><div class="line">	{</div><div class="line">		if ((! $access_rule[&apos;actions&apos;]) OR (! in_array(load_class(&apos;core_uri&apos;)-&gt;action, $access_rule[&apos;actions&apos;])))</div><div class="line">		{</div><div class="line">			self::login();</div><div class="line">		}</div><div class="line">	}</div><div class="line">	else if (isset($access_rule[&apos;actions&apos;]) AND in_array(load_class(&apos;core_uri&apos;)-&gt;action, $access_rule[&apos;actions&apos;]))	// &#x975E;&#x767D;&#x5C31;&#x662F;&#x9ED1;&#x540D;&#x5355;</div><div class="line">	{</div><div class="line">		self::login();</div><div class="line">	}</div><div class="line"></div><div class="line">}</div><div class="line">else</div><div class="line">{</div><div class="line">	self::login();</div><div class="line">}</div></pre></td></tr></table></figure>
<p>&#x767D;&#x540D;&#x5355;&#x4E2D;&#x7684;&#x4E0D;&#x9700;&#x8981;&#x767B;&#x9646;&#xFF0C;&#x9ED1;&#x540D;&#x5355;&#x4E2D;&#x7684;action&#x9700;&#x8981;&#x767B;&#x9646;</p>
<h2 id="Model&#x8BFB;&#x5199;&#x5206;&#x79BB;"><a href="#Model&#x8BFB;&#x5199;&#x5206;&#x79BB;" class="headerlink" title="Model&#x8BFB;&#x5199;&#x5206;&#x79BB;"></a>Model&#x8BFB;&#x5199;&#x5206;&#x79BB;</h2><p>&#x6240;&#x6709;&#x7684;&#x5177;&#x4F53;&#x7684;Model&#x90FD;&#x4ECE;AWS_MODEL&#x6D3E;&#x751F;&#x3002;</p>
<p>AWS_MODEL&#x4F9D;&#x8D56;core_db&#x5BF9;Zend_Db&#x7684;&#x5305;&#x88C5;&#x6765;&#x652F;&#x6301;&#x6570;&#x636E;&#x5E93;&#x76F8;&#x5173;&#x7684;&#x529F;&#x80FD;&#xFF0C;&#x53C2;&#x7167;&#xFF1A;</p>
<blockquote>
<p>system/core/db.php</p>
</blockquote>
<p>&#x521D;&#x59CB;&#x5316;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$this-&gt;db[&apos;master&apos;] = Zend_Db::factory(load_class(&apos;core_config&apos;)-&gt;get(&apos;database&apos;)-&gt;driver, load_class(&apos;core_config&apos;)-&gt;get(&apos;database&apos;)-&gt;master);</div></pre></td></tr></table></figure>
<p>&#x5207;&#x6362;&#x6570;&#x636E;&#x5E93;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">public function setObject($db_object_name = &apos;master&apos;)</div><div class="line">{</div><div class="line">	if (isset($this-&gt;db[$db_object_name]))</div><div class="line">	{</div><div class="line">		Zend_Registry::set(&apos;dbAdapter&apos;, $this-&gt;db[$db_object_name]);</div><div class="line">		Zend_Db_Table_Abstract::setDefaultAdapter($this-&gt;db[$db_object_name]);</div><div class="line"></div><div class="line">		$this-&gt;current_db_object = $db_object_name;</div><div class="line"></div><div class="line">		return $this-&gt;db[$db_object_name];</div><div class="line">	}</div><div class="line"></div><div class="line">	throw new Zend_Exception(&apos;Can\&apos;t find this db object: &apos; . $db_object_name);</div><div class="line">}</div></pre></td></tr></table></figure>
<p>AWS_MODEL&#x63D0;&#x4F9B;&#x5982;&#x4E0B;&#x529F;&#x80FD;</p>
<ul>
<li>&#x81EA;&#x52A8;&#x6DFB;&#x52A0;&#x8868;&#x524D;&#x7F00;</li>
<li>&#x6570;&#x636E;&#x5E93;&#x4E3B;&#x4ECE;&#x5207;&#x6362;</li>
<li>&#x57FA;&#x672C;CRUD</li>
<li>&#x4E8B;&#x52A1;&#x5904;&#x7406;</li>
<li>&#x811A;&#x672C;&#x6267;&#x884C;&#x5B8C;&#x540E;&#x7684;&#x6570;&#x636E;&#x5E93;&#x66F4;&#x65B0;&#x64CD;&#x4F5C;</li>
<li>&#x5206;&#x9875;&#x67E5;&#x8BE2;</li>
<li>&#x57FA;&#x672C;&#x7684;&#x7EDF;&#x8BA1; count\max\min\sum</li>
<li>quote</li>
</ul>
<p>&#x901A;&#x8FC7;&#x5BF9;db&#x64CD;&#x4F5C;&#x7684;&#x5C01;&#x88C5;&#xFF0C;&#x65B9;&#x4FBF;&#x5C06;&#x6240;&#x6709;&#x7684;&#x67E5;&#x8BE2;&#x64CD;&#x4F5C;&#x5207;&#x6362;&#x5230;&#x4ECE;&#x5E93;&#xFF0C;&#x66F4;&#x65B0;&#x4F7F;&#x7528;&#x4E3B;&#x5E93;&#xFF0C;&#x4ECE;&#x800C;&#x5B9E;&#x73B0;&#x8BFB;&#x5199;&#x5206;&#x79BB;&#x5BF9;&#x5177;&#x4F53;Model&#x7684;&#x5B9E;&#x73B0;&#x8005;&#x900F;&#x660E;&#x3002;</p>
<h2 id="&#x81EA;&#x52A8;&#x5F15;&#x5165;&#x673A;&#x5236;&#x548C;Autoload"><a href="#&#x81EA;&#x52A8;&#x5F15;&#x5165;&#x673A;&#x5236;&#x548C;Autoload" class="headerlink" title="&#x81EA;&#x52A8;&#x5F15;&#x5165;&#x673A;&#x5236;&#x548C;Autoload"></a>&#x81EA;&#x52A8;&#x5F15;&#x5165;&#x673A;&#x5236;&#x548C;Autoload</h2><p>&#x901A;&#x8FC7;&#x7EA6;&#x675F;model&#x7C7B;&#x3001;system&#x7C7B;&#x548C;config&#x7684;&#x5B58;&#x653E;&#x4F4D;&#x7F6E;&#x548C;&#x547D;&#x540D;&#x89C4;&#x5219;&#xFF0C;&#x5B9E;&#x73B0;&#x4E86;&#x4E0D;&#x9700;&#x8981;&#x4E8B;&#x5148;&#x5F15;&#x5165;&#x6587;&#x4EF6;&#x5C31;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x4F7F;&#x7528;, &#x8FD9;&#x4F7F;&#x5F97;&#x5728;&#x7F16;&#x7A0B;&#x8FC7;&#x7A0B;&#x4E2D;&#x53D8;&#x5F97;&#x65B9;&#x4FBF;&#x5FEB;&#x6377;, &#x4E5F;&#x907F;&#x514D;&#x4E86;&#x7C7B;&#x5E93;&#x91CD;&#x590D;&#x5B9E;&#x4F8B;&#x5316;&#x7684;&#x95EE;&#x9898;&#x3002;</p>
<p>&#x5177;&#x4F53;&#x7684;&#x89C4;&#x5219;&#x5982;&#x4E0B;&#xFF1A;</p>
<ol>
<li><p>model</p>
<p> &#x653E;&#x5728; model &#x76EE;&#x5F55;&#x4E0B;, &#x6587;&#x4EF6;&#x540D;: name.inc.php&#xFF0C;&#x7C7B;&#x540D;&#x91C7;&#x7528;name_class&#x7684;&#x683C;&#x5F0F;</p>
<ul>
<li><p>&#x5728;&#x7A0B;&#x5E8F;&#x4E2D;&#x4F7F;&#x7528;&#x65B9;&#x6CD5;: </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$this-&gt;model(&#x2018;name&#x2019;)-&gt;action();</div></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ol>
<pre><code>* &#x53EF;&#x7528;&#x8303;&#x56F4;: CONTROLLER, Model
</code></pre><ol>
<li><p>system</p>
<p> &#x653E;&#x5728; system &#x76EE;&#x5F55;&#x4E4B;&#x4E0B;, &#x7C7B;&#x540D;&#x76F8;&#x5BF9;&#x4E8E; system &#x76EE;&#x5F55;, &#x5C06; / &#x6362;&#x6210; _&#xFF0C;&#x4F8B;: </p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">Zend_Mail</div><div class="line">&#x8DEF;&#x5F84;: system/Zend/Mail.php</div><div class="line">&#x7C7B;&#x540D;: Zend_Mail</div></pre></td></tr></table></figure>
</li>
</ol>
<pre><code>* &#x5728;&#x7A0B;&#x5E8F;&#x4E2D;&#x4F7F;&#x7528;&#x65B9;&#x6CD5;: new, &#x9759;&#x6001;&#x8C03;&#x7528;, load_class(&#x2018;class_name&#x2019;);
* &#x53EF;&#x7528;&#x8303;&#x56F4;: &#x4EFB;&#x610F;, &#x4E0D;&#x9700;&#x8981;&#x5E26;&#x53C2;&#x6570;&#x5B9E;&#x4F8B;&#x5316;&#x5EFA;&#x8BAE;&#x4F7F;&#x7528; load_class
</code></pre><ol>
<li><p>config</p>
<p> &#x653E;&#x5728; system/config &#x76EE;&#x5F55;&#x4E4B;&#x4E0B;, &#x6587;&#x4EF6;&#x5185;&#x5BB9;&#x4E3A;&#x4E00;&#x4E2A; $config &#x6570;&#x7EC4;, &#x547D;&#x540D;&#x4E3A; &#x914D;&#x7F6E;&#x540D;.php</p>
<ul>
<li>&#x5728;&#x7A0B;&#x5E8F;&#x4E2D;&#x4F7F;&#x7528;&#x65B9;&#x6CD5;: AWS_APP::config()-&gt;get(&#x2018;&#x914D;&#x7F6E;&#x540D;&#x2019;)-&gt;&#x6570;&#x7EC4;&#x4E0B;&#x6807;</li>
<li>&#x53EF;&#x7528;&#x8303;&#x56F4;: &#x4EFB;&#x610F;, &#x4E0D;&#x9700;&#x8981;&#x5E26;&#x53C2;&#x6570;&#x5B9E;&#x4F8B;&#x5316;&#x5EFA;&#x8BAE;&#x4F7F;&#x7528; load_class</li>
</ul>
</li>
</ol>
<p><strong> Autoload </strong></p>
<p>&#x5728;&#x521D;&#x59CB;&#x5316;&#x811A;&#x672C; <code>init.php</code> &#x91CC;&#x52A0;&#x8F7D;&#x7C7B;</p>
<blockquote>
<p>system/init.php</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">128 load_class(&apos;core_autoload&apos;);</div></pre></td></tr></table></figure>
<p>&#x5728; core_autoload&#x7684;&#x6784;&#x9020;&#x8FC7;&#x7A0B;&#x6CE8;&#x518C;&#x52A0;&#x8F7D;&#x5904;&#x7406;&#x51FD;&#x6570;</p>
<blockquote>
<p>system/core/autoload.php#__construct</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">36 spl_autoload_register(array($this, &apos;loader&apos;));</div></pre></td></tr></table></figure>
<p>&#x7C7B;&#x52A0;&#x8F7D;&#x51FD;&#x6570;&#x5904;&#x7406;</p>
<ul>
<li>&#x6309;&#x8DEF;&#x5F84;&#x52A0;&#x8F7D;</li>
<li>&#x522B;&#x540D;&#x7C7B;&#x7684;&#x52A0;&#x8F7D;&#xFF0C;&#x5305;&#x62EC;&#xFF1A;TPL/FORMAT/HTTP/H/ACTION_LOG</li>
<li>models&#x7C7B;&#x7684;&#x52A0;&#x8F7D;</li>
<li>class&#x7C7B;&#x7684;&#x52A0;&#x8F7D;</li>
</ul>
<p>&#x627E;&#x5230;&#x76EE;&#x6807;&#x7C7B;&#x7684;&#x8DEF;&#x5F84;&#x540E;&#x76F4;&#x63A5;&#x52A0;&#x8F7D;&#xFF0C;&#x5E76;&#x7F13;&#x5B58;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">require $class_file_location;</div><div class="line"></div><div class="line">self::$loaded_class[$class_name] = $class_file_location;</div></pre></td></tr></table></figure>
<p>plugin&#x7684;model&#x7C7B;&#x52A0;&#x8F7D;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">if (class_exists(&apos;AWS_APP&apos;, false))</div><div class="line">{</div><div class="line">	if (AWS_APP::plugins()-&gt;model())</div><div class="line">	{</div><div class="line">		self::$aliases = array_merge(self::$aliases, AWS_APP::plugins()-&gt;model());</div><div class="line">	}</div><div class="line">}</div></pre></td></tr></table></figure>
<h2 id="&#x63D2;&#x4EF6;&#x673A;&#x5236;"><a href="#&#x63D2;&#x4EF6;&#x673A;&#x5236;" class="headerlink" title="&#x63D2;&#x4EF6;&#x673A;&#x5236;"></a>&#x63D2;&#x4EF6;&#x673A;&#x5236;</h2><p>&#x867D;&#x7136;wecenter&#x6709;&#x4E00;&#x4E2A;&#x521D;&#x7EA7;&#x63D2;&#x4EF6;&#x6A21;&#x578B;&#xFF0C;&#x4F46;&#x5F88;&#x9057;&#x61BE;&#x5E76;&#x6CA1;&#x6709;&#x7B2C;&#x4E09;&#x65B9;&#x57FA;&#x4E8E;&#x8FD9;&#x5957;&#x673A;&#x5236;&#x53BB;&#x5F00;&#x53D1;&#x63D2;&#x4EF6;&#xFF0C;&#x8FDE;&#x5B98;&#x65B9;&#x7AD9;&#x70B9;&#x7684;&#x6302;&#x51FA;&#x7684;<code>&#x63D2;&#x4EF6;</code>&#x4E5F;&#x53EA;&#x662F;&#x91C7;&#x7528;&#x4E8C;&#x6B21;&#x5F00;&#x53D1;&#x7684;&#x65B9;&#x5F0F;&#xFF0C;&#x5E76;&#x4E0D;&#x662F;&#x57FA;&#x4E8E;&#x63D2;&#x4EF6;&#x5F00;&#x53D1;&#x7684;&#x3002;</p>
<h3 id="&#x76EE;&#x524D;&#x6709;&#x54EA;&#x4E9B;&#x63D2;&#x4EF6;"><a href="#&#x76EE;&#x524D;&#x6709;&#x54EA;&#x4E9B;&#x63D2;&#x4EF6;" class="headerlink" title="&#x76EE;&#x524D;&#x6709;&#x54EA;&#x4E9B;&#x63D2;&#x4EF6;"></a>&#x76EE;&#x524D;&#x6709;&#x54EA;&#x4E9B;&#x63D2;&#x4EF6;</h3><p>&#x9879;&#x76EE;&#x4E2D;&#x5185;&#x7F6E;&#x4E24;&#x4E2A;&#x63D2;&#x4EF6;</p>
<ul>
<li>aws_external</li>
<li>aws_offical_external</li>
</ul>
<p>&#x63D0;&#x4F9B;&#x4E86;&#x51E0;&#x4E2A;utility&#x51FD;&#x6570;</p>
<h3 id="&#x63D2;&#x4EF6;&#x7684;&#x7ED3;&#x6784;"><a href="#&#x63D2;&#x4EF6;&#x7684;&#x7ED3;&#x6784;" class="headerlink" title="&#x63D2;&#x4EF6;&#x7684;&#x7ED3;&#x6784;"></a>&#x63D2;&#x4EF6;&#x7684;&#x7ED3;&#x6784;</h3><p>&#x5178;&#x578B;&#x7684;&#x63D2;&#x4EF6;&#x7ED3;&#x6784;&#x5982;&#x4E0B;&#x6240;&#x793A;&#xFF1A;</p>
<p>&#x6BCF;&#x4E2A;&#x63D2;&#x4EF6;&#x4E00;&#x4E2A;&#x4E3A;plugins&#x91CC;&#x7684;&#x4E00;&#x4E2A;&#x76EE;&#x5F55;&#xFF0C;&#x76EE;&#x5F55;&#x4E0B;&#x7684;<code>config.php</code>&#x4E3A;&#x63D2;&#x4EF6;&#x7684;&#x5143;&#x6570;&#x636E;&#x4FE1;&#x606F;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line">$aws_plugin = array(</div><div class="line">	&apos;title&apos; =&gt; &apos;External for Anwsion&apos;,	// &#x63D2;&#x4EF6;&#x6807;&#x9898;</div><div class="line">	&apos;version&apos; =&gt; 20130107,	// &#x63D2;&#x4EF6;&#x7248;&#x672C;</div><div class="line">	&apos;description&apos; =&gt; &apos;Anwsion &#x5B98;&#x7F51;&#x8C03;&#x7528;&#x63D2;&#x4EF6;&apos;,	// &#x63D2;&#x4EF6;&#x63CF;&#x8FF0;</div><div class="line">	&apos;requirements&apos; =&gt; &apos;20120706&apos;,	// &#x6700;&#x4F4E; Build &#x8981;&#x6C42;</div><div class="line">	</div><div class="line">	&apos;contents&apos; =&gt; array(</div><div class="line">		// &#x5BF9;&#x63A7;&#x5236;&#x5668;&#x6784;&#x9020;&#x90E8;&#x7F72;&#x4EE3;&#x7801; (setup)</div><div class="line">		&apos;setups&apos; =&gt; array(</div><div class="line">			array(</div><div class="line">			&apos;app&apos; =&gt; &apos;app&apos;,</div><div class="line">			&apos;controller&apos; =&gt; &apos;controller&apos;,</div><div class="line">			&apos;include&apos; =&gt; &apos;aws_plungin_controller.php&apos;</div><div class="line">			)</div><div class="line">		),</div><div class="line">	</div><div class="line">		// &#x5BF9;&#x63A7;&#x5236;&#x5668; Action &#x90E8;&#x7F72;&#x4EE3;&#x7801; (&#x53EA;&#x652F;&#x6301;&#x6A21;&#x677F;&#x8F93;&#x51FA;&#x4E4B;&#x524D;)</div><div class="line">		&apos;actions&apos; =&gt; array(</div><div class="line">			array(</div><div class="line">			&apos;app&apos; =&gt; &apos;app&apos;,</div><div class="line">			&apos;controller&apos; =&gt; &apos;controller&apos;,</div><div class="line">			&apos;action&apos; =&gt; &apos;action&apos;,</div><div class="line">			&apos;template&apos; =&gt; &apos;template.tpl&apos;,</div><div class="line">			&apos;include&apos; =&gt; &apos;aws_plungin_controller.php&apos;</div><div class="line">			)</div><div class="line">		),</div><div class="line">		</div><div class="line">		// &#x6CE8;&#x518C; Model, &#x7528; $this-&gt;model(&apos;name&apos;) &#x8BBF;&#x95EE;</div><div class="line">		&apos;model&apos; =&gt; array(</div><div class="line">			&apos;class_name&apos; =&gt; &apos;aws_offical_external_class&apos;,	// Model name, &#x4EE5; _class &#x7ED3;&#x5C3E;</div><div class="line">			&apos;include&apos; =&gt; &apos;aws_offical_external.php&apos;,	// &#x5F15;&#x5165;&#x4EE3;&#x7801;&#x6587;&#x4EF6;&#x4F4D;&#x7F6E;</div><div class="line">		),</div><div class="line">	),</div><div class="line">);</div></pre></td></tr></table></figure>
<p>&#x5305;&#x62EC;&#xFF1A;</p>
<ul>
<li>&#x521D;&#x59CB;&#x5316;&#x4EE3;&#x7801;</li>
<li>action</li>
<li>model</li>
</ul>
<h3 id="&#x63D2;&#x4EF6;&#x7684;&#x5143;&#x6570;&#x636E;&#x52A0;&#x8F7D;"><a href="#&#x63D2;&#x4EF6;&#x7684;&#x5143;&#x6570;&#x636E;&#x52A0;&#x8F7D;" class="headerlink" title="&#x63D2;&#x4EF6;&#x7684;&#x5143;&#x6570;&#x636E;&#x52A0;&#x8F7D;"></a>&#x63D2;&#x4EF6;&#x7684;&#x5143;&#x6570;&#x636E;&#x52A0;&#x8F7D;</h3><p>&#x5E94;&#x7528;&#x542F;&#x52A8;&#x65F6;&#x52A0;&#x8F7D;&#x63D2;&#x4EF6;&#x7BA1;&#x7406;&#x5668;(core_plugins)</p>
<blockquote>
<p>aws_app.inc.app#init</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">117 self::$plugins = load_class(&apos;core_plugins&apos;);</div></pre></td></tr></table></figure>
<p>&#x68C0;&#x7D22;&#x6240;&#x6709;&#x63D2;&#x4EF6;&#x76EE;&#x5F55;&#xFF0C;&#x5E76;&#x52A0;&#x8F7D;&#x5143;&#x6570;&#x636E;</p>
<blockquote>
<p>aws_app.inc.app#load_plugins()</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div></pre></td><td class="code"><pre><div class="line">$dir_handle = opendir($this-&gt;plugins_path);</div><div class="line"></div><div class="line">	    while (($file = readdir($dir_handle)) !== false)</div><div class="line">	    {</div><div class="line">	       	if ($file != &apos;.&apos; AND $file != &apos;..&apos; AND is_dir($this-&gt;plugins_path . $file))</div><div class="line">	       	{</div><div class="line">	       		$config_file = $this-&gt;plugins_path . $file . &apos;/config.php&apos;;</div><div class="line"></div><div class="line">	            if (file_exists($config_file))</div><div class="line">	            {</div><div class="line">	            	$aws_plugin = false;</div><div class="line"></div><div class="line">		            require_once($config_file);</div><div class="line"></div><div class="line">		            if (is_array($aws_plugin) AND G_VERSION_BUILD &gt;= $aws_plugin[&apos;requirements&apos;])</div><div class="line">		            {</div><div class="line">		            	if ($aws_plugin[&apos;contents&apos;][&apos;model&apos;])</div><div class="line">		            	{</div><div class="line">			            	$this-&gt;plugins_model[$aws_plugin[&apos;contents&apos;][&apos;model&apos;][&apos;class_name&apos;]] = $this-&gt;plugins_path . $file . &apos;/&apos; . $aws_plugin[&apos;contents&apos;][&apos;model&apos;][&apos;include&apos;];</div><div class="line">		            	}</div><div class="line"></div><div class="line">		            	if ($aws_plugin[&apos;contents&apos;][&apos;setups&apos;])</div><div class="line">		            	{</div><div class="line">			            	foreach ($aws_plugin[&apos;contents&apos;][&apos;setups&apos;] AS $key =&gt; $data)</div><div class="line">			            	{</div><div class="line">			            		if ($data[&apos;app&apos;] AND $data[&apos;controller&apos;] AND $data[&apos;include&apos;])</div><div class="line">			            		{</div><div class="line">				            		$this-&gt;plugins_table[$data[&apos;app&apos;]][$data[&apos;controller&apos;]][&apos;setup&apos;][] = array(</div><div class="line">				            			&apos;file&apos; =&gt; $this-&gt;plugins_path . $file . &apos;/&apos; . $data[&apos;include&apos;],</div><div class="line">				            		);</div><div class="line">			            		}</div><div class="line">			            	}</div><div class="line">		            	}</div><div class="line"></div><div class="line">		            	if ($aws_plugin[&apos;contents&apos;][&apos;actions&apos;])</div><div class="line">		            	{</div><div class="line">			            	foreach ($aws_plugin[&apos;contents&apos;][&apos;actions&apos;] AS $key =&gt; $data)</div><div class="line">			            	{</div><div class="line">			            		if ($data[&apos;app&apos;] AND $data[&apos;controller&apos;] AND $data[&apos;include&apos;])</div><div class="line">			            		{</div><div class="line">				            		$this-&gt;plugins_table[$data[&apos;app&apos;]][$data[&apos;controller&apos;]][$data[&apos;action&apos;]][] = array(</div><div class="line">				            			&apos;file&apos; =&gt; $this-&gt;plugins_path . $file . &apos;/&apos; . $data[&apos;include&apos;],</div><div class="line">				            			&apos;template&apos; =&gt; $data[&apos;template&apos;]</div><div class="line">				            		);</div><div class="line">			            		}</div><div class="line">			            	}</div><div class="line">		            	}</div><div class="line"></div><div class="line">			            $this-&gt;plugins[$file] = $aws_plugin;</div><div class="line">		            }</div><div class="line">	            }</div><div class="line">	        }</div><div class="line">	    }</div><div class="line"></div><div class="line">	   	closedir($dir_handle);</div></pre></td></tr></table></figure>
<p>&#x5C06;&#x5143;&#x6570;&#x636E;&#x5199;&#x5165;&#x7F13;&#x5B58;</p>
<h3 id="&#x8F7D;&#x5165;&#x63D2;&#x4EF6;"><a href="#&#x8F7D;&#x5165;&#x63D2;&#x4EF6;" class="headerlink" title="&#x8F7D;&#x5165;&#x63D2;&#x4EF6;"></a>&#x8F7D;&#x5165;&#x63D2;&#x4EF6;</h3><p>Controller&#x7684;&#x521D;&#x59CB;&#x5316;&#x51FD;&#x6570;&#x91CC;&#x4F1A;&#x6839;&#x636E;&#x53C2;&#x6570;&#x52A0;&#x8F7D;&#x5BF9;&#x5E94;&#x7684;&#x63D2;&#x4EF6;</p>
<blockquote>
<p>aws_controller.inc.php#__construct</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">// &#x8F7D;&#x5165;&#x63D2;&#x4EF6;</div><div class="line">if ($plugins = AWS_APP::plugins()-&gt;parse($_GET[&apos;app&apos;], $_GET[&apos;c&apos;], &apos;setup&apos;))</div><div class="line">{</div><div class="line">	foreach ($plugins as $plugin_file)</div><div class="line">	{</div><div class="line">		include $plugin_file;</div><div class="line">	}</div><div class="line">}</div></pre></td></tr></table></figure>
<p>&#x6A21;&#x7248;&#x6E32;&#x67D3;&#x65F6;&#x4F1A;&#x5524;&#x8D77;&#x63D2;&#x4EF6;</p>
<blockquote>
<p>system/class/cls_template.inc.php#output</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">if ($plugins = AWS_APP::plugins()-&gt;parse($_GET[&apos;app&apos;], $_GET[&apos;c&apos;], $_GET[&apos;act&apos;], str_replace(self::$template_ext, &apos;&apos;, $template_filename)))</div><div class="line">{</div><div class="line">	foreach ($plugins AS $plugin_file)</div><div class="line">	{</div><div class="line">		include_once $plugin_file;</div><div class="line">	}</div><div class="line">}</div></pre></td></tr></table></figure>
<p>&#x6B64;&#x5916;&#xFF0C;&#x5B9A;&#x65F6;&#x4EFB;&#x52A1;&#x4E5F;&#x4F1A;&#x5524;&#x8D77;&#x63D2;&#x4EF6;</p>
<blockquote>
<p>app/crond/main.php#run_action</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">if ($plugins = AWS_APP::plugins()-&gt;parse(&apos;crond&apos;, &apos;main&apos;, $call_action))</div><div class="line">{</div><div class="line">	foreach ($plugins AS $plugin_file)</div><div class="line">	{</div><div class="line">		include($plugin_file);</div><div class="line">	}</div><div class="line">}</div></pre></td></tr></table></figure>
<h3 id="&#x63D2;&#x4EF6;&#x600E;&#x4E48;&#x4F7F;&#x7528;"><a href="#&#x63D2;&#x4EF6;&#x600E;&#x4E48;&#x4F7F;&#x7528;" class="headerlink" title="&#x63D2;&#x4EF6;&#x600E;&#x4E48;&#x4F7F;&#x7528;"></a>&#x63D2;&#x4EF6;&#x600E;&#x4E48;&#x4F7F;&#x7528;</h3><p>&#x7531;&#x4E8E;Autoload&#x4F1A;&#x5904;&#x7406;Plugin&#x91CC;model&#x7C7B;&#x7684;&#x52A0;&#x8F7D;&#xFF0C;&#x6240;&#x6709;model&#x7C7B;&#x7684;&#x4F7F;&#x7528;&#x65B9;&#x5F0F;&#x5E76;&#x65E0;&#x4E8C;&#x822C;&#x3002;&#x5982;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$this-&gt;model(&apos;aws_external&apos;)-&gt;format_js_question_ul_output($_GET[&apos;ul_class&apos;],$_GET[&apos;is_recommend&apos;]));</div></pre></td></tr></table></figure>
<p>&#x63D2;&#x4EF6;&#x7684;controller&#x5982;&#x4F55;&#x8DEF;&#x7531;</p>
<h2 id="Cache&#x7684;&#x5B9E;&#x73B0;&#x539F;&#x7406;"><a href="#Cache&#x7684;&#x5B9E;&#x73B0;&#x539F;&#x7406;" class="headerlink" title="Cache&#x7684;&#x5B9E;&#x73B0;&#x539F;&#x7406;"></a>Cache&#x7684;&#x5B9E;&#x73B0;&#x539F;&#x7406;</h2><p>wecenter&#x652F;&#x6301;&#x4E24;&#x79CD;&#x7F13;&#x5B58;</p>
<ul>
<li>Memcached</li>
<li>File</li>
</ul>
<p>&#x57FA;&#x4E8E;Zend_Cache&#x5B9E;&#x73B0;&#x7684;&#x6587;&#x4EF6;&#x7F13;&#x5B58;&#x673A;&#x5236;&#x3002;</p>
<blockquote>
<p>system/core/cache.php </p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$this-&gt;cache_factory = Zend_Cache::factory($this-&gt;frontendName, $this-&gt;backendName, $this-&gt;frontendOptions, $this-&gt;backendOptions);</div></pre></td></tr></table></figure>
<p>&#x8BFB;&#x7F13;&#x5B58;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$result = $this-&gt;cache_factory-&gt;load($this-&gt;cachePrefix . $key);</div></pre></td></tr></table></figure>
<p>&#x5199;&#x7F13;&#x5B58;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$result = $this-&gt;cache_factory-&gt;save($value, $this-&gt;cachePrefix . $key, array(), $lifetime);</div></pre></td></tr></table></figure>
<p>&#x5220;&#x9664;&#x7F13;&#x5B58;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">return $this-&gt;cache_factory-&gt;remove($key);</div></pre></td></tr></table></figure>
<p>&#x6E05;&#x7406;&#x7F13;&#x5B58;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">return $this-&gt;cache_factory-&gt;clean(Zend_Cache::CLEANING_MODE_ALL);</div></pre></td></tr></table></figure>
<h3 id="Zend-Cache"><a href="#Zend-Cache" class="headerlink" title="Zend Cache"></a>Zend Cache</h3><p>&#x4E3A;&#x4E86;&#x65B9;&#x4FBF;&#x4F7F;&#x7528;&#xFF0C;Zend Cache&#x6839;&#x636E;&#x7F13;&#x5B58;&#x7684;&#x6570;&#x636E;&#x7C7B;&#x578B;&#x6784;&#x9020;&#x4E86;&#x5404;&#x79CD; FrontCache&#xFF0C;&#x4EE5;&#x53CA;&#x6839;&#x636E;&#x7F13;&#x5B58;&#x7684;&#x5B58;&#x50A8;&#x7C7B;&#x578B;&#x5F15;&#x5165;&#x4E86;BackendCache&#x7684;&#x6982;&#x5FF5;&#x3002;</p>
<p><strong> Frontend </strong></p>
<ul>
<li><p>Capture</p>
<p>Capture&#x80FD;&#x5C06;php&#x7684;start&#x548C;flush&#x4E4B;&#x95F4;&#x7684;&#x8F93;&#x51FA;&#x7F13;&#x5B58;&#x8D77;&#x6765;&#xFF0C;&#x5185;&#x90E8;&#x5B9E;&#x73B0;&#x6302;&#x4E86;&#x4F7F;&#x7528;&#x4E86;ob_start&#x4E3B;&#x6301;&#x7684;output_callback&#x6765;&#x7F13;&#x5B58;&#x6570;&#x636E;</p>
<blockquote>
<p>Zend/Cache/Frontend/Capture.php#start</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">ob_start(array($this, &apos;_flush&apos;));</div><div class="line">ob_implicit_flush(false);</div></pre></td></tr></table></figure>
</li>
</ul>
<p>  &#x901A;&#x8FC7;&#x8C03;&#x7528;<code>ob_flush</code>&#x6765;&#x5237;&#x65B0;&#x7F13;&#x51B2;&#x533A;</p>
<ul>
<li><p>Page</p>
<p>&#x6355;&#x83B7;&#x8F93;&#x51FA;&#x7684;&#x90E8;&#x5206;&#x5185;&#x5BB9;</p>
</li>
<li><p>Output</p>
<p>  &#x4F7F;&#x7528;&#x65B9;&#x5F0F;</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">// if it is a cache miss, output buffering is triggered</div><div class="line">if (! $cache-&gt;start(&apos;mypage&apos;)) {</div><div class="line">   // output everything as usual</div><div class="line">   echo &apos;Hello world! &apos;;</div><div class="line">   echo &apos;This is cached (&apos;.time().&apos;) &apos;;</div><div class="line">   $cache-&gt;end(); // output buffering ends</div><div class="line">}</div><div class="line">echo &apos;This is never cached (&apos;.time().&apos;).&apos;;</div></pre></td></tr></table></figure>
</li>
<li><p>Class</p>
<p>  &#x901A;&#x8FC7;&#x5B9E;&#x73B0;__call&#xFF0C;&#x63D0;&#x4F9B;&#x5BF9;&#x76EE;&#x6807;&#x5BF9;&#x8C61;&#x7684;&#x4EE3;&#x7406;&#xFF0C;&#x5E76;&#x7F13;&#x5B58;&#x51FD;&#x6570;&#x8C03;&#x7528;&#x7684;&#x7ED3;&#x679C;&#x3002;</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div></pre></td><td class="code"><pre><div class="line">public function __call($name, $parameters)</div><div class="line">   {</div><div class="line">       $callback = array($this-&gt;_cachedEntity, $name);</div><div class="line"></div><div class="line">       if (!is_callable($callback, false)) {</div><div class="line">           Zend_Cache::throwException(&apos;Invalid callback&apos;);</div><div class="line">       }</div><div class="line"></div><div class="line">       $cacheBool1 = $this-&gt;_specificOptions[&apos;cache_by_default&apos;];</div><div class="line">       $cacheBool2 = in_array($name, $this-&gt;_specificOptions[&apos;cached_methods&apos;]);</div><div class="line">       $cacheBool3 = in_array($name, $this-&gt;_specificOptions[&apos;non_cached_methods&apos;]);</div><div class="line">       $cache      = (($cacheBool1 || $cacheBool2) &amp;&amp; (!$cacheBool3));</div><div class="line"></div><div class="line">       if (!$cache) {</div><div class="line">           // We do not have not cache</div><div class="line">           return call_user_func_array($callback, $parameters);</div><div class="line">       }</div><div class="line"></div><div class="line">       $id = $this-&gt;makeId($name, $parameters);</div><div class="line">       if (($rs = $this-&gt;load($id)) &amp;&amp; (array_key_exists(0, $rs))</div><div class="line">           &amp;&amp; (array_key_exists(1, $rs))</div><div class="line">       ) {</div><div class="line">           // A cache is available</div><div class="line">           $output = $rs[0];</div><div class="line">           $return = $rs[1];</div><div class="line">       } else {</div><div class="line">           // A cache is not available (or not valid for this frontend)</div><div class="line">           ob_start();</div><div class="line">           ob_implicit_flush(false);</div><div class="line"></div><div class="line">           try {</div><div class="line">               $return = call_user_func_array($callback, $parameters);</div><div class="line">               $output = ob_get_clean();</div><div class="line">               $data   = array($output, $return);</div><div class="line"></div><div class="line">               $this-&gt;save(</div><div class="line">                   $data, $id, $this-&gt;_tags, $this-&gt;_specificLifetime,</div><div class="line">                   $this-&gt;_priority</div><div class="line">               );</div><div class="line">           } catch (Exception $e) {</div><div class="line">               ob_end_clean();</div><div class="line">               throw $e;</div><div class="line">           }</div><div class="line">       }</div><div class="line"></div><div class="line">       echo $output;</div><div class="line">       return $return;</div><div class="line">   }</div></pre></td></tr></table></figure>
</li>
<li><p>Function</p>
<p>  &#x7F13;&#x5B58;&#x51FD;&#x6570;&#x8C03;&#x7528;&#x7684;&#x7ED3;&#x679C;</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">function call($callback, array $parameters = array(), $tags = array(), $specificLifetime = false, $priority = 8)</div></pre></td></tr></table></figure>
<p>  &#x8C03;&#x7528;&#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#xFF0C;&#x4F1A;&#x8DDF;&#x8FDB;&#x51FD;&#x6570;&#x540D;&#x79F0;&#x548C;&#x53C2;&#x6570;&#x751F;&#x6210;&#x7F13;&#x5B58;&#x4E3B;&#x952E;&#xFF0C;&#x5982;&#x679C;&#x7F13;&#x5B58;&#x6709;&#x6548;&#xFF0C;&#x5219;&#x76F4;&#x63A5;&#x8FD4;&#x56DE;&#x7F13;&#x5B58;&#x7ED3;&#x679C;&#xFF0C;&#x5426;&#x5219;&#x8C03;&#x7528;&#x51FD;&#x6570;&#x5E76;&#x8FDB;&#x884C;&#x7F13;&#x5B58;&#xFF0C;&#x4E0E;classs&#x7684;__call&#x5B9E;&#x73B0;&#x57FA;&#x672C;&#x4E00;&#x81F4;&#x3002;</p>
</li>
<li><p>File</p>
<p>  &#x6839;&#x636E;&#x6587;&#x4EF6;&#x7684;&#x4FEE;&#x6539;&#x72B6;&#x6001;&#x6765;&#x5224;&#x65AD;&#x7F13;&#x5B58;&#x662F;&#x5426;&#x6709;&#x6548;&#x3002;</p>
</li>
</ul>
<p><strong> Backend </strong></p>
<p>&#x9700;&#x8981;&#x7B26;&#x5408;&#x57FA;&#x672C;&#x7684;&#x63A5;&#x53E3;</p>
<blockquote>
<p>Zend/Cache/Backend/Interface.php</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">public function setDirectives($directives);</div><div class="line">public function load($id, $doNotTestCacheValidity = false);</div><div class="line">public function test($id);</div><div class="line">public function save($data, $id, $tags = array(), $specificLifetime = false);</div><div class="line">public function remove($id);</div><div class="line">public function clean($mode = Zend_Cache::CLEANING_MODE_ALL, $tags = array());</div></pre></td></tr></table></figure>
<ul>
<li><p>File</p>
<p>  &#x57FA;&#x4E8E;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x7684;&#x7F13;&#x5B58;&#x3002;</p>
<p>  &#x6BCF;&#x4E2A;&#x7F13;&#x5B58;&#x9664;&#x4E86;&#x751F;&#x5B58;&#x7F13;&#x5B58;&#x6587;&#x4EF6;&#x5916;&#xFF0C;&#x8FD8;&#x4F1A;&#x751F;&#x51FA;&#x4E00;&#x4E2A;&#x6587;&#x4EF6;&#x540D;&#x4EE5;<code>internal-metadatas---</code>&#x5F00;&#x5934;&#x7684;&#x5143;&#x6570;&#x636E;&#x6587;&#x4EF6;&#xFF0C;&#x5E76;&#x4F9D;&#x9760;&#x5143;&#x6570;&#x636E;&#x6587;&#x4EF6;&#x6765;&#x5B58;&#x50A8;&#x6570;&#x636E;&#x7684;&#x57FA;&#x672C;&#x4FE1;&#x606F;&#xFF1A;</p>
<blockquote>
<p>Zend/Cache/Backend/File.php#touch</p>
</blockquote>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&apos;hash&apos; =&gt; $metadatas[&apos;hash&apos;],</div><div class="line">   &apos;mtime&apos; =&gt; time(),</div><div class="line">   &apos;expire&apos; =&gt; $metadatas[&apos;expire&apos;] + $extraLifetime,</div><div class="line">   &apos;tags&apos; =&gt; $metadatas[&apos;tags&apos;]</div></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li><p>Sqlite</p>
<p>  &#x5C06;&#x6570;&#x636E;&#x548C;&#x5143;&#x6570;&#x636E;&#x5B58;&#x50A8;&#x5230;sqlite&#x4E2D;</p>
<blockquote>
<p>Zend/Cache/Backend/Sqlite.php#_buildStructure</p>
</blockquote>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"> private function _buildStructure()</div><div class="line">{</div><div class="line">    $this-&gt;_query(&apos;DROP INDEX tag_id_index&apos;);</div><div class="line">    $this-&gt;_query(&apos;DROP INDEX tag_name_index&apos;);</div><div class="line">    $this-&gt;_query(&apos;DROP INDEX cache_id_expire_index&apos;);</div><div class="line">    $this-&gt;_query(&apos;DROP TABLE version&apos;);</div><div class="line">    $this-&gt;_query(&apos;DROP TABLE cache&apos;);</div><div class="line">    $this-&gt;_query(&apos;DROP TABLE tag&apos;);</div><div class="line">    $this-&gt;_query(&apos;CREATE TABLE version (num INTEGER PRIMARY KEY)&apos;);</div><div class="line">    $this-&gt;_query(&apos;CREATE TABLE cache (id TEXT PRIMARY KEY, content BLOB, lastModified INTEGER, expire INTEGER)&apos;);</div><div class="line">    $this-&gt;_query(&apos;CREATE TABLE tag (name TEXT, id TEXT)&apos;);</div><div class="line">    $this-&gt;_query(&apos;CREATE INDEX tag_id_index ON tag(id)&apos;);</div><div class="line">    $this-&gt;_query(&apos;CREATE INDEX tag_name_index ON tag(name)&apos;);</div><div class="line">    $this-&gt;_query(&apos;CREATE INDEX cache_id_expire_index ON cache(id, expire)&apos;);</div><div class="line">    $this-&gt;_query(&apos;INSERT INTO version (num) VALUES (1)&apos;);</div><div class="line">}</div></pre></td></tr></table></figure>
<p>  &#x987E;&#x540D;&#x601D;&#x4E49;&#xFF0C;cache&#x5B58;&#x50A8;&#x7F13;&#x5B58;&#x6570;&#x636E;&#xFF0C;tag&#x5B58;&#x50A8;&#x6807;&#x7B7E;, version&#x5B58;&#x50A8;&#x7F13;&#x5B58;&#x7684;&#x7248;&#x672C;&#x53F7;&#x3002;</p>
<p>  &#x6BCF;&#x6B21;&#x6267;&#x884C;&#x64CD;&#x4F5C;&#x4E4B;&#x524D;&#x90FD;&#x4F1A;&#x8C03;&#x7528; <code>_checkAndBuildStructure</code> &#x68C0;&#x67E5;&#x662F;&#x5426;&#x9700;&#x8981;&#x6784;&#x5EFA;&#x8868;&#x7ED3;&#x6784;</p>
</li>
</ul>
<ul>
<li><p>memcached</p>
<p>  &#x4F9D;&#x8D56;<code>Memcache</code>&#x5BA2;&#x6237;&#x7AEF;&#x6765;&#x63D0;&#x4F9B;&#x670D;&#x52A1;&#x3002;</p>
</li>
<li><p>libmemcached</p>
<p>  &#x4F9D;&#x8D56;<code>Memcached</code>&#x6765;&#x63D0;&#x4F9B;&#x670D;&#x52A1;</p>
</li>
<li><p>xcache</p>
<p>  &#x6765;&#x81EA;&#x4E8E;lightd&#x56E2;&#x961F;&#x7684;&#x5F00;&#x6E90;&#x7F13;&#x5B58;&#x670D;&#x52A1;&#x5668;</p>
</li>
<li><p>Apc</p>
</li>
<li>BlackHole</li>
<li>Static</li>
<li>TwoLevels</li>
<li><p>WinCache</p>
<p>  wincache&#x4EC5;&#x652F;&#x6301;NTS(&#x975E;&#x7EBF;&#x7A0B;&#x5B89;&#x5168;&#x7248;&#x672C;)&#x7684;PHP</p>
</li>
<li><p>ZendServer Disk</p>
</li>
<li>ZendServer Share memeory</li>
<li>ZendPlatform</li>
</ul>
<p>&#x6D89;&#x53CA;&#x7684;&#x7F13;&#x5B58;&#x670D;&#x52A1;&#x592A;&#x591A;&#xFF0C;&#x4E0D;&#x80FD;&#x4E00;&#x4E00;&#x63A2;&#x7A76;&#x3002;</p>
<h2 id="&#x914D;&#x7F6E;&#x53C2;&#x6570;&#x7BA1;&#x7406;"><a href="#&#x914D;&#x7F6E;&#x53C2;&#x6570;&#x7BA1;&#x7406;" class="headerlink" title="&#x914D;&#x7F6E;&#x53C2;&#x6570;&#x7BA1;&#x7406;"></a>&#x914D;&#x7F6E;&#x53C2;&#x6570;&#x7BA1;&#x7406;</h2><p>wecenter&#x7684;&#x914D;&#x7F6E;&#x6709;&#x4E24;&#x79CD;&#xFF1A;</p>
<ul>
<li>system_setting&#x89C4;&#x8303;&#x5316;&#x7684;&#x952E;&#x503C;&#x5BF9;&#xFF0C;&#x901A;&#x8FC7;get_setting&#x8BBF;&#x95EE;</li>
<li>&#x7531;core_config&#x7BA1;&#x7406;&#x7684;&#x5404;&#x7C7B;&#x5F02;&#x6784;&#x914D;&#x7F6E;&#x6570;&#x636E;</li>
</ul>
<h3 id="get-setting"><a href="#get-setting" class="headerlink" title="get_setting"></a>get_setting</h3><p><strong> &#x4F7F;&#x7528;&#x65B9;&#x5F0F; </strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">get_setting(&apos;weibo_msg_enabled&apos;)</div></pre></td></tr></table></figure>
<p><strong> &#x5B9E;&#x73B0; </strong></p>
<blockquote>
<p>system/functions.inc.php</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line">function get_setting($varname = null, $permission_check = true)</div><div class="line">{</div><div class="line">	if (! class_exists(&apos;AWS_APP&apos;, false))</div><div class="line">	{</div><div class="line">		return false;</div><div class="line">	}</div><div class="line"></div><div class="line">	if ($settings = AWS_APP::$settings)</div><div class="line">	{</div><div class="line">		// AWS_APP::session()-&gt;permission &#x662F;&#x6307;&#x5F53;&#x524D;&#x7528;&#x6237;&#x6240;&#x5728;&#x7528;&#x6237;&#x7EC4;&#x7684;&#x6743;&#x9650;&#x8BB8;&#x53EF;&#x9879;&#xFF0C;&#x5728; users_group &#x8868;&#x4E2D;&#xFF0C;&#x4F60;&#x53EF;&#x4EE5;&#x770B;&#x5230; permission &#x5B57;&#x6BB5;</div><div class="line">		if ($permission_check AND $settings[&apos;upload_enable&apos;] == &apos;Y&apos;)</div><div class="line">		{</div><div class="line">			if (AWS_APP::session())</div><div class="line">			{</div><div class="line">				if (!AWS_APP::session()-&gt;permission[&apos;upload_attach&apos;])</div><div class="line">				{</div><div class="line">					$settings[&apos;upload_enable&apos;] = &apos;N&apos;;</div><div class="line">				}</div><div class="line">			}</div><div class="line">		}</div><div class="line">	}</div><div class="line"></div><div class="line">	if ($varname)</div><div class="line">	{</div><div class="line">		return $settings[$varname];</div><div class="line">	}</div><div class="line">	else</div><div class="line">	{</div><div class="line">		return $settings;</div><div class="line">	}</div><div class="line">}</div></pre></td></tr></table></figure>
<p>AWS_APP::$settings&#x662F;&#x4ECE;&#x6570;&#x636E;&#x5E93;&#x52A0;&#x8F7D;&#x7684;&#x5185;&#x5BB9;</p>
<blockquote>
<p>system/aws_app.inc.php#init</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">self::$settings = self::model(&apos;setting&apos;)-&gt;get_settings();</div></pre></td></tr></table></figure>
<blockquote>
<p>models/setting.php#get_settings</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">public function get_settings()</div><div class="line">{</div><div class="line">	if ($system_setting = $this-&gt;fetch_all(&apos;system_setting&apos;))</div><div class="line">	{</div><div class="line">		foreach ($system_setting as $key =&gt; $val)</div><div class="line">		{</div><div class="line">			if ($val[&apos;value&apos;])</div><div class="line">			{</div><div class="line">				$val[&apos;value&apos;] = unserialize($val[&apos;value&apos;]);</div><div class="line">			}</div><div class="line"></div><div class="line">			$settings[$val[&apos;varname&apos;]] = $val[&apos;value&apos;];</div><div class="line">		}</div><div class="line">	}</div><div class="line"></div><div class="line">	return $settings;</div><div class="line">}</div></pre></td></tr></table></figure>
<p>system_setting&#x8868;&#x4E2D;&#x7684;&#x6570;&#x636E;&#x6709;&#x5B89;&#x88C5;&#x811A;&#x672C;&#x63D2;&#x5165;&#xFF0C;&#x5185;&#x5BB9;&#x7686;&#x4E3A;&#x952E;&#x503C;&#x5BF9;</p>
<blockquote>
<p>install/system_settings.sql</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">INSERT INTO `[#DB_PREFIX#]system_setting` (`varname`, `value`) VALUES</div><div class="line">(&apos;site_name&apos;, &apos;s:8:&quot;WeCenter&quot;;&apos;),</div><div class="line">(&apos;description&apos;, &apos;s:30:&quot;WeCenter &#x793E;&#x4EA4;&#x5316;&#x77E5;&#x8BC6;&#x793E;&#x533A;&quot;;&apos;),</div><div class="line">(&apos;keywords&apos;, &apos;s:47:&quot;WeCenter,&#x77E5;&#x8BC6;&#x793E;&#x533A;,&#x793E;&#x4EA4;&#x793E;&#x533A;,&#x95EE;&#x7B54;&#x793E;&#x533A;&quot;;&apos;),</div><div class="line">(&apos;sensitive_words&apos;, &apos;s:0:&quot;&quot;;&apos;),</div><div class="line">(&apos;def_focus_uids&apos;, &apos;s:1:&quot;1&quot;;&apos;),</div><div class="line">(&apos;answer_edit_time&apos;, &apos;s:2:&quot;30&quot;;&apos;),</div><div class="line">(&apos;cache_level_high&apos;, &apos;s:2:&quot;60&quot;;&apos;),</div><div class="line">...</div></pre></td></tr></table></figure>
<h3 id="core-config"><a href="#core-config" class="headerlink" title="core_config"></a>core_config</h3><p><strong> &#x4F7F;&#x7528;&#x65B9;&#x5F0F; </strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$admin_menu = (array)AWS_APP::config()-&gt;get(&apos;admin_menu&apos;);</div></pre></td></tr></table></figure>
<p><strong> &#x5B9E;&#x73B0; </strong></p>
<p>get&#x7684;&#x8C03;&#x7528;&#x4F1A;&#x4ECE;&#x5185;&#x5B58;&#x4E2D;&#x67E5;&#x627E;&#xFF0C;&#x5982;&#x679C;&#x627E;&#x4E0D;&#x5230;&#x6700;&#x7EC8;&#x4F1A;&#x8C03;&#x7528;<code>load_config</code></p>
<blockquote>
<p>system/core/config.php#get</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">function get($config_id)</div><div class="line">{</div><div class="line">	...</div><div class="line"></div><div class="line">	if (isset($this-&gt;config[$config_id]))</div><div class="line">	{</div><div class="line">		return $this-&gt;config[$config_id];</div><div class="line">	}</div><div class="line">	else</div><div class="line">	{</div><div class="line">		return $this-&gt;load_config($config_id);</div><div class="line">	}</div><div class="line">}</div></pre></td></tr></table></figure>
<p>load_config&#x4F1A;&#x4ECE;config&#x76EE;&#x5F55;&#x52A0;&#x8F7D;&#x6307;&#x5B9A;Id&#x4E3A;&#x6587;&#x4EF6;&#x540D;&#x7684;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#xFF0C;&#x5E76;&#x7F13;&#x51B2;&#x5230;&#x5185;&#x5B58;&#x4E2D;</p>
<blockquote>
<p>system/core/config.php#load_config</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">function load_config($config_id)</div><div class="line">{</div><div class="line">	if (substr($config_id, -10) == &apos;.extension&apos; OR !file_exists(AWS_PATH . &apos;config/&apos; . $config_id . &apos;.php&apos;))</div><div class="line">	{</div><div class="line">		throw new Zend_Exception(&apos;The configuration file config/&apos; . $config_id . &apos;.php does not exist.&apos;);</div><div class="line">	}</div><div class="line"></div><div class="line">	include_once(AWS_PATH . &apos;config/&apos; . $config_id . &apos;.php&apos;);</div><div class="line"></div><div class="line">	if (!is_array($config))</div><div class="line">	{</div><div class="line">		throw new Zend_Exception(&apos;Your config/&apos; . $config_id . &apos;.php file does not appear to contain a valid configuration array.&apos;);</div><div class="line">	}</div><div class="line"></div><div class="line">	$this-&gt;config[$config_id] = (object)$config;</div><div class="line"></div><div class="line">	return $this-&gt;config[$config_id];</div><div class="line">}</div></pre></td></tr></table></figure>
<p>&#x53E6;&#x5916;&#xFF0C;core_config&#x8FD8;&#x63D0;&#x4F9B;&#x4E86;&#x4E00;&#x4E2A;&#x52A8;&#x6001;&#x5199;&#x914D;&#x7F6E;&#x5230;&#x6587;&#x4EF6;&#x7684;&#x529F;&#x80FD;</p>
<blockquote>
<p>system/core/config.php#set</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line">public function set($config_id, $data)</div><div class="line">{</div><div class="line">	if (!$data || ! is_array($data))</div><div class="line">	{</div><div class="line">		throw new Zend_Exception(&apos;config data type error&apos;);</div><div class="line">	}</div><div class="line"></div><div class="line">	$content = &quot;&lt;?php\n\n&quot;;</div><div class="line"></div><div class="line">	foreach($data as $key =&gt; $val)</div><div class="line">	{</div><div class="line">		if (is_array($val))</div><div class="line">		{</div><div class="line">			$content .= &quot;\$config[&apos;{$key}&apos;] = &quot; . var_export($val, true) . &quot;;&quot;;;</div><div class="line">		}</div><div class="line">		else if (is_bool($val))</div><div class="line">		{</div><div class="line">			$content .= &quot;\$config[&apos;{$key}&apos;] = &quot; . ($val ? &apos;true&apos; : &apos;false&apos;) . &quot;;&quot;;</div><div class="line">		}</div><div class="line">		else</div><div class="line">		{</div><div class="line">			$content .= &quot;\$config[&apos;{$key}&apos;] = &apos;&quot; . addcslashes($val, &quot;&apos;&quot;) . &quot;&apos;;&quot;;</div><div class="line">		}</div><div class="line"></div><div class="line">		$content .= &quot;\r\n&quot;;</div><div class="line">	}</div><div class="line"></div><div class="line">	$config_path = AWS_PATH . &apos;config/&apos; . $config_id . &apos;.php&apos;;</div><div class="line"></div><div class="line">	$fp = @fopen($config_path, &quot;w&quot;);</div><div class="line"></div><div class="line">	@chmod($config_path, 0777);</div><div class="line"></div><div class="line">	$fwlen = @fwrite($fp, $content);</div><div class="line"></div><div class="line">	@fclose($fp);</div><div class="line"></div><div class="line">	return $fwlen;</div><div class="line">}</div></pre></td></tr></table></figure>
<h2 id="&#x9A8C;&#x8BC1;&#x7801;"><a href="#&#x9A8C;&#x8BC1;&#x7801;" class="headerlink" title="&#x9A8C;&#x8BC1;&#x7801;"></a>&#x9A8C;&#x8BC1;&#x7801;</h2><p>&#x9A8C;&#x8BC1;&#x9700;&#x8981;&#x8003;&#x8651;</p>
<ul>
<li>&#x9A8C;&#x8BC1;&#x7801;&#x56FE;&#x7247;&#x7684;&#x751F;&#x6210;&#x3001;&#x5B58;&#x50A8;&#x548C;&#x8BBF;&#x95EE;</li>
<li>&#x9A8C;&#x8BC1;&#x7801;&#x7684;&#x6709;&#x6548;&#x671F;&#x7BA1;&#x7406;</li>
<li>&#x5931;&#x6548;&#x9A8C;&#x8BC1;&#x7801;&#x7684;&#x6E05;&#x7406;&#x7B56;&#x7565;</li>
<li>&#x9A8C;&#x8BC1;&#x6709;&#x6548;&#x6027;</li>
</ul>
<p>&#x57FA;&#x4E8E; <code>Zend_Captcha_Image</code> &#x5B9E;&#x73B0;&#x7684;&#x9A8C;&#x8BC1;&#x7801;&#x751F;&#x6210;&#x548C;&#x7BA1;&#x7406;&#x529F;&#x80FD;&#xFF0C;&#x53EF;&#x4EE5;&#x6839;&#x636E;&#x81EA;&#x5DF1;&#x63D0;&#x4F9B;&#x7684;&#x5B57;&#x4F53;&#x6587;&#x4EF6;&#x751F;&#x6210;&#x81EA;&#x5B9A;&#x4E49;&#x5927;&#x5C0F;&#x548C;&#x4F4D;&#x6570;&#x7684;&#x9A8C;&#x8BC1;&#x7801;&#xFF0C;<br>&#x5E76;&#x5B58;&#x50A8;&#x5230;&#x5355;&#x72EC;&#x7684;session&#x547D;&#x540D;&#x7A7A;&#x95F4;&#x4E2D;``&#x3002;</p>
<blockquote>
<p>system/core/captcha.php#__construct</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">$this-&gt;captcha = new Zend_Captcha_Image(array(</div><div class="line">	&apos;font&apos; =&gt; $this-&gt;get_font(),</div><div class="line">	&apos;imgdir&apos; =&gt; $img_dir,</div><div class="line">	&apos;fontsize&apos; =&gt; rand(20, 22),</div><div class="line">	&apos;width&apos; =&gt; 100,</div><div class="line">	&apos;height&apos; =&gt; 40,</div><div class="line">	&apos;wordlen&apos; =&gt; 4,</div><div class="line">	&apos;session&apos; =&gt; new Zend_Session_Namespace(G_COOKIE_PREFIX . &apos;_Captcha&apos;),</div><div class="line">	&apos;timeout&apos; =&gt; 600</div><div class="line">));</div><div class="line"></div><div class="line">$this-&gt;captcha-&gt;setDotNoiseLevel(rand(3, 6));</div><div class="line">$this-&gt;captcha-&gt;setLineNoiseLevel(rand(1, 2));</div></pre></td></tr></table></figure>
<p><strong> &#x4F7F;&#x7528;&#x65B9;&#x5F0F;&#x548C;&#x5B9E;&#x73B0;&#x539F;&#x7406; </strong></p>
<p>&#x751F;&#x6210;&#x9A8C;&#x8BC1;&#x7801;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">AWS_APP::captcha()-&gt;generate();</div></pre></td></tr></table></figure>
<blockquote>
<p>system/core/captcha.php#generate</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">public function generate()</div><div class="line">{</div><div class="line">	$this-&gt;captcha-&gt;generate();</div><div class="line"></div><div class="line">	HTTP::no_cache_header();</div><div class="line"></div><div class="line">	readfile($this-&gt;captcha-&gt;getImgDir() . $this-&gt;captcha-&gt;getId() . $this-&gt;captcha-&gt;getSuffix());</div><div class="line"></div><div class="line">	die;</div><div class="line">}</div></pre></td></tr></table></figure>
<p>&#x68C0;&#x67E5;&#x9A8C;&#x8BC1;&#x7801;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">if (!AWS_APP::captcha()-&gt;is_validate($_POST[&apos;seccode_verify&apos;]) AND get_setting(&apos;register_seccode&apos;) == &apos;Y&apos;)</div><div class="line">{</div><div class="line">	H::ajax_json_output(AWS_APP::RSM(null, -1, AWS_APP::lang()-&gt;_t(&apos;&#x8BF7;&#x586B;&#x5199;&#x6B63;&#x786E;&#x7684;&#x9A8C;&#x8BC1;&#x7801;&apos;)));</div><div class="line">}</div></pre></td></tr></table></figure>
<blockquote>
<p>system/core/captcha.php#is_validate</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">public function is_validate($validate_code, $generate_new = true)</div><div class="line">{</div><div class="line">	if (strtolower($this-&gt;captcha-&gt;getWord()) == strtolower($validate_code))</div><div class="line">	{</div><div class="line">		if ($generate_new)</div><div class="line">		{</div><div class="line">			$this-&gt;captcha-&gt;generate();</div><div class="line">		}</div><div class="line">		</div><div class="line">		return true;</div><div class="line">	}</div><div class="line"></div><div class="line">	return false;</div><div class="line">}</div></pre></td></tr></table></figure>
<h3 id="Zend-Captcha-Image"><a href="#Zend-Captcha-Image" class="headerlink" title="Zend_Captcha_Image"></a>Zend_Captcha_Image</h3><p><strong> &#x751F;&#x6210;&#x9A8C;&#x8BC1;&#x7801;&#x56FE;&#x7247; </strong></p>
<blockquote>
<p>Zend/Captcha/Image.php</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">public function generate()</div><div class="line">{</div><div class="line">    $id = parent::generate();</div><div class="line">    $tries = 5;</div><div class="line">    // If there&apos;s already such file, try creating a new ID</div><div class="line">    while($tries-- &amp;&amp; file_exists($this-&gt;getImgDir() . $id . $this-&gt;getSuffix())) {</div><div class="line">        $id = $this-&gt;_generateRandomId();</div><div class="line">        $this-&gt;_setId($id);</div><div class="line">    }</div><div class="line">    $this-&gt;_generateImage($id, $this-&gt;getWord());</div><div class="line"></div><div class="line">    if (mt_rand(1, $this-&gt;getGcFreq()) == 1) {</div><div class="line">        $this-&gt;_gc();</div><div class="line">    }</div><div class="line">    return $id;</div><div class="line">}</div></pre></td></tr></table></figure>
<blockquote>
<p>Zend/Captcha/Image.php</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div></pre></td><td class="code"><pre><div class="line">protected function _generateImage($id, $word)</div><div class="line">{</div><div class="line">    if (!extension_loaded(&quot;gd&quot;)) {</div><div class="line">        //require_once &apos;Zend/Captcha/Exception.php&apos;;</div><div class="line">        throw new Zend_Captcha_Exception(&quot;Image CAPTCHA requires GD extension&quot;);</div><div class="line">    }</div><div class="line"></div><div class="line">    if (!function_exists(&quot;imagepng&quot;)) {</div><div class="line">        //require_once &apos;Zend/Captcha/Exception.php&apos;;</div><div class="line">        throw new Zend_Captcha_Exception(&quot;Image CAPTCHA requires PNG support&quot;);</div><div class="line">    }</div><div class="line"></div><div class="line">    if (!function_exists(&quot;imageftbbox&quot;)) {</div><div class="line">        //require_once &apos;Zend/Captcha/Exception.php&apos;;</div><div class="line">        throw new Zend_Captcha_Exception(&quot;Image CAPTCHA requires FT fonts support&quot;);</div><div class="line">    }</div><div class="line"></div><div class="line">    $font = $this-&gt;getFont();</div><div class="line"></div><div class="line">    if (empty($font)) {</div><div class="line">        //require_once &apos;Zend/Captcha/Exception.php&apos;;</div><div class="line">        throw new Zend_Captcha_Exception(&quot;Image CAPTCHA requires font&quot;);</div><div class="line">    }</div><div class="line"></div><div class="line">    $w     = $this-&gt;getWidth();</div><div class="line">    $h     = $this-&gt;getHeight();</div><div class="line">    $fsize = $this-&gt;getFontSize();</div><div class="line"></div><div class="line">    $img_file   = $this-&gt;getImgDir() . $id . $this-&gt;getSuffix();</div><div class="line">    if(empty($this-&gt;_startImage)) {</div><div class="line">        $img        = imagecreatetruecolor($w, $h);</div><div class="line">    } else {</div><div class="line">        $img = imagecreatefrompng($this-&gt;_startImage);</div><div class="line">        if(!$img) {</div><div class="line">            //require_once &apos;Zend/Captcha/Exception.php&apos;;</div><div class="line">            throw new Zend_Captcha_Exception(&quot;Can not load start image&quot;);</div><div class="line">        }</div><div class="line">        $w = imagesx($img);</div><div class="line">        $h = imagesy($img);</div><div class="line">    }</div><div class="line">    $text_color = imagecolorallocate($img, 0, 0, 0);</div><div class="line">    $bg_color   = imagecolorallocate($img, 255, 255, 255);</div><div class="line">    imagefilledrectangle($img, 0, 0, $w-1, $h-1, $bg_color);</div><div class="line">    $textbox = imageftbbox($fsize, 0, $font, $word);</div><div class="line">    $x = ($w - ($textbox[2] - $textbox[0])) / 2;</div><div class="line">    $y = ($h - ($textbox[7] - $textbox[1])) / 2;</div><div class="line">    imagefttext($img, $fsize, 0, $x, $y, $text_color, $font, $word);</div><div class="line"></div><div class="line">   // generate noise</div><div class="line">    for ($i=0; $i&lt;$this-&gt;_dotNoiseLevel; $i++) {</div><div class="line">       imagefilledellipse($img, mt_rand(0,$w), mt_rand(0,$h), 2, 2, $text_color);</div><div class="line">    }</div><div class="line">    for($i=0; $i&lt;$this-&gt;_lineNoiseLevel; $i++) {</div><div class="line">       imageline($img, mt_rand(0,$w), mt_rand(0,$h), mt_rand(0,$w), mt_rand(0,$h), $text_color);</div><div class="line">    }</div><div class="line"></div><div class="line">    // transformed image</div><div class="line">    $img2     = imagecreatetruecolor($w, $h);</div><div class="line">    $bg_color = imagecolorallocate($img2, 255, 255, 255);</div><div class="line">    imagefilledrectangle($img2, 0, 0, $w-1, $h-1, $bg_color);</div><div class="line">    // apply wave transforms</div><div class="line">    $freq1 = $this-&gt;_randomFreq();</div><div class="line">    $freq2 = $this-&gt;_randomFreq();</div><div class="line">    $freq3 = $this-&gt;_randomFreq();</div><div class="line">    $freq4 = $this-&gt;_randomFreq();</div><div class="line"></div><div class="line">    $ph1 = $this-&gt;_randomPhase();</div><div class="line">    $ph2 = $this-&gt;_randomPhase();</div><div class="line">    $ph3 = $this-&gt;_randomPhase();</div><div class="line">    $ph4 = $this-&gt;_randomPhase();</div><div class="line"></div><div class="line">    $szx = $this-&gt;_randomSize();</div><div class="line">    $szy = $this-&gt;_randomSize();</div><div class="line"></div><div class="line">    for ($x = 0; $x &lt; $w; $x++) {</div><div class="line">        for ($y = 0; $y &lt; $h; $y++) {</div><div class="line">            $sx = $x + (sin($x*$freq1 + $ph1) + sin($y*$freq3 + $ph3)) * $szx;</div><div class="line">            $sy = $y + (sin($x*$freq2 + $ph2) + sin($y*$freq4 + $ph4)) * $szy;</div><div class="line"></div><div class="line">            if ($sx &lt; 0 || $sy &lt; 0 || $sx &gt;= $w - 1 || $sy &gt;= $h - 1) {</div><div class="line">                continue;</div><div class="line">            } else {</div><div class="line">                $color    = (imagecolorat($img, $sx, $sy) &gt;&gt; 16)         &amp; 0xFF;</div><div class="line">                $color_x  = (imagecolorat($img, $sx + 1, $sy) &gt;&gt; 16)     &amp; 0xFF;</div><div class="line">                $color_y  = (imagecolorat($img, $sx, $sy + 1) &gt;&gt; 16)     &amp; 0xFF;</div><div class="line">                $color_xy = (imagecolorat($img, $sx + 1, $sy + 1) &gt;&gt; 16) &amp; 0xFF;</div><div class="line">            }</div><div class="line">            if ($color == 255 &amp;&amp; $color_x == 255 &amp;&amp; $color_y == 255 &amp;&amp; $color_xy == 255) {</div><div class="line">                // ignore background</div><div class="line">                continue;</div><div class="line">            } elseif ($color == 0 &amp;&amp; $color_x == 0 &amp;&amp; $color_y == 0 &amp;&amp; $color_xy == 0) {</div><div class="line">                // transfer inside of the image as-is</div><div class="line">                $newcolor = 0;</div><div class="line">            } else {</div><div class="line">                // do antialiasing for border items</div><div class="line">                $frac_x  = $sx-floor($sx);</div><div class="line">                $frac_y  = $sy-floor($sy);</div><div class="line">                $frac_x1 = 1-$frac_x;</div><div class="line">                $frac_y1 = 1-$frac_y;</div><div class="line"></div><div class="line">                $newcolor = $color    * $frac_x1 * $frac_y1</div><div class="line">                          + $color_x  * $frac_x  * $frac_y1</div><div class="line">                          + $color_y  * $frac_x1 * $frac_y</div><div class="line">                          + $color_xy * $frac_x  * $frac_y;</div><div class="line">            }</div><div class="line">            imagesetpixel($img2, $x, $y, imagecolorallocate($img2, $newcolor, $newcolor, $newcolor));</div><div class="line">        }</div><div class="line">    }</div><div class="line"></div><div class="line">    // generate noise</div><div class="line">    for ($i=0; $i&lt;$this-&gt;_dotNoiseLevel; $i++) {</div><div class="line">        imagefilledellipse($img2, mt_rand(0,$w), mt_rand(0,$h), 2, 2, $text_color);</div><div class="line">    }</div><div class="line">    for ($i=0; $i&lt;$this-&gt;_lineNoiseLevel; $i++) {</div><div class="line">       imageline($img2, mt_rand(0,$w), mt_rand(0,$h), mt_rand(0,$w), mt_rand(0,$h), $text_color);</div><div class="line">    }</div><div class="line"></div><div class="line">    imagepng($img2, $img_file);</div><div class="line">    imagedestroy($img);</div><div class="line">    imagedestroy($img2);</div><div class="line">}</div></pre></td></tr></table></figure>
<p>&#x57FA;&#x672C;&#x6B65;&#x9AA4;</p>
<ol>
<li>&#x4F7F;&#x7528;&#x57FA;&#x5E95;&#x56FE;&#x751F;&#x6210;&#x7F13;&#x51B2;&#x56FE;&#x7247;</li>
<li>&#x8F93;&#x51FA;&#x9A8C;&#x8BC1;&#x7801;&#x6587;&#x672C;</li>
<li>&#x6839;&#x636E;&#x70B9;&#x548C;&#x7EBF;&#x7684;&#x566A;&#x97F3;&#x7EA7;&#x522B;&#x751F;&#x6210;&#x566A;&#x97F3;&#x56FE;&#x5F62;</li>
<li>&#x8FDB;&#x884C;&#x6CE2;&#x5F62;&#x626D;&#x66F2;&#x53D8;&#x6362;</li>
<li>&#x518D;&#x6B21;&#x751F;&#x6210;&#x566A;&#x58F0;&#x70B9;&#x548C;&#x7EBF;</li>
<li>&#x4FDD;&#x5B58;&#x56FE;&#x7247;&#x5230;PNG&#x683C;&#x5F0F;&#x7684;&#x6587;&#x4EF6;</li>
</ol>
<p><strong> &#x9A8C;&#x8BC1;&#x7801;&#x7BA1;&#x7406; </strong></p>
<p>&#x9A8C;&#x8BC1;&#x7801;&#x7BA1;&#x7406;&#x7684;&#x57FA;&#x7840;&#x5DE5;&#x4F5C;&#x5728; <code>Zend_Captcha_Word</code>&#x4E2D;&#x5B8C;&#x6210;&#xFF0C;&#x57FA;&#x672C;&#x5B9E;&#x73B0;&#x601D;&#x8DEF;</p>
<ul>
<li><p>&#x5C06;&#x751F;&#x6210;&#x7684;&#x9A8C;&#x8BC1;&#x7801;code&#x5B58;&#x5165;session&#x4E2D;</p>
<blockquote>
<p>Zend/Captcha/Word.php</p>
</blockquote>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">public function generate()</div><div class="line">   {</div><div class="line">       if (!$this-&gt;_keepSession) {</div><div class="line">           $this-&gt;_session = null;</div><div class="line">       }</div><div class="line">       $id = $this-&gt;_generateRandomId();</div><div class="line">       $this-&gt;_setId($id);</div><div class="line">       $word = $this-&gt;_generateWord();</div><div class="line">       $this-&gt;_setWord($word);</div><div class="line">       return $id;</div><div class="line">   }</div></pre></td></tr></table></figure>
</li>
</ul>
<pre><code><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">protected function _setWord($word)</div><div class="line">{</div><div class="line">    $session       = $this-&gt;getSession();</div><div class="line">    $session-&gt;word = $word;</div><div class="line">    $this-&gt;_word   = $word;</div><div class="line">    return $this;</div><div class="line">}</div></pre></td></tr></table></figure>
</code></pre><ul>
<li><p>&#x9A8C;&#x8BC1;&#x65F6;&#x76F4;&#x63A5;&#x4ECE;session&#x4E2D;&#x8BFB;&#x53D6;&#x5E76;&#x9A8C;&#x8BC1;</p>
<blockquote>
<p>Zend/Captcha.Word.php</p>
</blockquote>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">public function isValid($value, $context = null)</div><div class="line">   {</div><div class="line">       ...</div><div class="line"></div><div class="line">       $this-&gt;_id = $value[&apos;id&apos;];</div><div class="line">       if ($input !== $this-&gt;getWord()) {</div><div class="line">           $this-&gt;_error(self::BAD_CAPTCHA);</div><div class="line">           return false;</div><div class="line">       }</div><div class="line"></div><div class="line">       return true;</div><div class="line">   }</div><div class="line">   </div><div class="line">   public function getWord()</div><div class="line">   {</div><div class="line">       if (empty($this-&gt;_word)) {</div><div class="line">           $session     = $this-&gt;getSession();</div><div class="line">           $this-&gt;_word = $session-&gt;word;</div><div class="line">       }</div><div class="line">       return $this-&gt;_word;</div><div class="line">   }</div></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li><p>&#x6E05;&#x9664;session&#x4E2D;&#x7684;&#x9A8C;&#x8BC1;&#x7801;</p>
<p>  &#x901A;&#x8FC7;&#x63A7;&#x5236;Session&#x6570;&#x636E;&#x5931;&#x6548;&#x65F6;&#x95F4;&#x548C;&#x6B65;&#x6570;&#x6765;&#x6E05;&#x9664;Session&#x4E2D;&#x7684;&#x9A8C;&#x8BC1;&#x7801;</p>
<blockquote>
<p>Zend/Captcha.Word.php</p>
</blockquote>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">public function getSession()</div><div class="line">{</div><div class="line">    if (!isset($this-&gt;_session) || (null === $this-&gt;_session)) {</div><div class="line">        $id = $this-&gt;getId();</div><div class="line">        if (!class_exists($this-&gt;_sessionClass)) {</div><div class="line">            //require_once &apos;Zend/Loader.php&apos;;</div><div class="line">            Zend_Loader::loadClass($this-&gt;_sessionClass);</div><div class="line">        }</div><div class="line">        $this-&gt;_session = new $this-&gt;_sessionClass(&apos;Zend_Form_Captcha_&apos; . $id);</div><div class="line">        $this-&gt;_session-&gt;setExpirationHops(1, null, true);</div><div class="line">        $this-&gt;_session-&gt;setExpirationSeconds($this-&gt;getTimeout());</div><div class="line">    }</div><div class="line">    return $this-&gt;_session;</div><div class="line">}</div></pre></td></tr></table></figure>
</li>
</ul>
<p><strong> &#x6E05;&#x7406;&#x5931;&#x6548;&#x9A8C;&#x8BC1;&#x7801;&#x56FE;&#x7247; </strong></p>
<p>&#x904D;&#x5386;&#x9A8C;&#x8BC1;&#x7801;&#x5B58;&#x50A8;&#x7684;&#x6587;&#x4EF6;&#x5939;&#xFF0C;&#x6309;&#x521B;&#x5EFA;&#x4E16;&#x754C;&#x5220;&#x9664;&#x6709;&#x6548;&#x671F;&#xFF08;&#x6700;&#x957F;&#x6709;&#x6548;&#x671F;&#x9ED8;&#x8BA4;10&#x5206;&#x949F;&#xFF09;&#x4E4B;&#x5916;&#x7684;&#x56FE;&#x7247;&#x6587;&#x4EF6;&#x3002;</p>
<p>&#x53C2;&#x7167; </p>
<blockquote>
<p>Zend/Captcha/Image.php#_gc</p>
</blockquote>
<p>GC&#x5728;&#x751F;&#x6210;&#x9A8C;&#x8BC1;&#x7801;&#x7684;&#x65F6;&#x5019;&#x6309;&#x6982;&#x7387;&#x968F;&#x673A;&#x89E6;&#x53D1;</p>
<blockquote>
<p>Zend/Captcha/Image.php#generate</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">if (mt_rand(1, $this-&gt;getGcFreq()) == 1) {</div><div class="line">    $this-&gt;_gc();</div><div class="line">}</div></pre></td></tr></table></figure>
<p>&#x9664;&#x81EA;&#x5DF1;&#x751F;&#x6210;&#x5E76;&#x7BA1;&#x7406;&#x9A8C;&#x8BC1;&#x7801;&#x5916;&#xFF0C;Zend Captcha&#x8FD8;&#x652F;&#x6301;&#x76F4;&#x63A5;&#x4F7F;&#x7528;<code>reCaptcha</code>&#x670D;&#x52A1;&#x6765;&#x7BA1;&#x7406;&#x9A8C;&#x8BC1;&#x7801;&#xFF0C;</p>
<h2 id="&#x5206;&#x9875;&#x7EC4;&#x4EF6;&#x7684;&#x5B9E;&#x73B0;"><a href="#&#x5206;&#x9875;&#x7EC4;&#x4EF6;&#x7684;&#x5B9E;&#x73B0;" class="headerlink" title="&#x5206;&#x9875;&#x7EC4;&#x4EF6;&#x7684;&#x5B9E;&#x73B0;"></a>&#x5206;&#x9875;&#x7EC4;&#x4EF6;&#x7684;&#x5B9E;&#x73B0;</h2><p>&#x5206;&#x9875;&#x662F;&#x5217;&#x8868;&#x5C55;&#x793A;&#x5E38;&#x89C1;&#x7684;&#x9700;&#x6C42;&#xFF0C;&#x56E0;&#x800C;wecenter&#x63D0;&#x4F9B;&#x4E86;&#x4E00;&#x4E2A;&#x57FA;&#x7840;&#x7684;&#x5206;&#x9875;&#x5DE5;&#x5177;&#x7C7B; <code>core_pagination</code>&#x3002;</p>
<p>&#x53EA;&#x6709;&#x63D0;&#x4F9B;</p>
<ul>
<li>base_url</li>
<li>total_rows</li>
<li>per_page</li>
</ul>
<p>&#x5C31;&#x80FD;&#x751F;&#x6210;&#x4E00;&#x4E2A;&#x5206;&#x9875;&#x5BFC;&#x822A;&#x89C6;&#x56FE;</p>
<h3 id="&#x4F7F;&#x7528;"><a href="#&#x4F7F;&#x7528;" class="headerlink" title="&#x4F7F;&#x7528;"></a>&#x4F7F;&#x7528;</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">TPL::assign(&apos;pagination&apos;, AWS_APP::pagination()-&gt;initialize(array(</div><div class="line">				&apos;base_url&apos; =&gt; get_js_url(&apos;/admin/approval/list/type-&apos; . $_GET[&apos;type&apos;]),</div><div class="line">				&apos;total_rows&apos; =&gt; $found_rows,</div><div class="line">				&apos;per_page&apos; =&gt; $this-&gt;per_page</div><div class="line">			))-&gt;create_links());</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;span class=&quot;pull-right mod-page&quot;&gt;&lt;?php echo $this-&gt;pagination; ?&gt;&lt;/span&gt;</div></pre></td></tr></table></figure>
<h3 id="&#x5B9E;&#x73B0;"><a href="#&#x5B9E;&#x73B0;" class="headerlink" title="&#x5B9E;&#x73B0;"></a>&#x5B9E;&#x73B0;</h3><p>&#x57FA;&#x672C;&#x53EF;&#x4EE5;&#x5B9A;&#x4E49;&#x53C2;&#x6570;</p>
<blockquote>
<p>views/default/config/pagination.php</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">$config = array(</div><div class="line">	&apos;first_link&apos; =&gt; &apos;&amp;lt;&amp;lt;&apos;,</div><div class="line">	&apos;next_link&apos; =&gt; &apos;&amp;gt;&apos;,</div><div class="line">	&apos;prev_link&apos; =&gt; &apos;&amp;lt;&apos;,</div><div class="line">	&apos;last_link&apos; =&gt; &apos;&amp;gt;&amp;gt;&apos;,</div><div class="line">	&apos;uri_segment&apos; =&gt; 3,</div><div class="line">	&apos;full_tag_open&apos; =&gt; &apos;&lt;div class=&quot;page-control&quot;&gt;&lt;ul class=&quot;pagination pull-right&quot;&gt;&apos;,</div><div class="line">	&apos;full_tag_close&apos; =&gt; &apos;&lt;/ul&gt;&lt;/div&gt;&apos;,</div><div class="line">	&apos;first_tag_open&apos; =&gt; &apos;&lt;li&gt;&apos;,</div><div class="line">	&apos;first_tag_close&apos; =&gt; &apos;&lt;/li&gt;&apos;,</div><div class="line">	&apos;last_tag_open&apos; =&gt; &apos;&lt;li&gt;&apos;,</div><div class="line">	&apos;last_tag_close&apos; =&gt; &apos;&lt;/li&gt;&apos;,</div><div class="line">	&apos;first_url&apos; =&gt; &apos;&apos;, // Alternative URL for the First Page.</div><div class="line">	&apos;cur_tag_open&apos; =&gt; &apos;&lt;li class=&quot;active&quot;&gt;&lt;a href=&quot;javascript:;&quot;&gt;&apos;,</div><div class="line">	&apos;cur_tag_close&apos; =&gt; &apos;&lt;/a&gt;&lt;/li&gt;&apos;,</div><div class="line">	&apos;next_tag_open&apos; =&gt; &apos;&lt;li&gt;&apos;,</div><div class="line">	&apos;next_tag_close&apos; =&gt; &apos;&lt;/li&gt;&apos;,</div><div class="line">	&apos;prev_tag_open&apos; =&gt; &apos;&lt;li&gt;&apos;,</div><div class="line">	&apos;prev_tag_close&apos; =&gt; &apos;&lt;/li&gt;&apos;,</div><div class="line">	&apos;num_tag_open&apos; =&gt; &apos;&lt;li&gt;&apos;,</div><div class="line">	&apos;num_tag_close&apos; =&gt; &apos;&lt;/li&gt;&apos;,</div><div class="line">	&apos;display_pages&apos; =&gt; TRUE,</div><div class="line">	&apos;anchor_class&apos; =&gt; &apos;&apos;,</div><div class="line">	&apos;num_links&apos; =&gt; 3</div><div class="line">);</div></pre></td></tr></table></figure>
<p>&#x5177;&#x4F53;&#x903B;&#x8F91;&#x53C2;&#x7167; </p>
<blockquote>
<p>system/core/pagination.php#create_links</p>
</blockquote>
<p>&#x57FA;&#x672C;&#x601D;&#x8DEF;</p>
<ul>
<li>&#x6839;&#x636E;&#x603B;&#x8BB0;&#x5F55;&#x6570;&#x7B97;&#x51FA;&#x603B;&#x9875;&#x6570;</li>
<li>&#x6839;&#x636E;&#x5F53;&#x524D;&#x9875;&#x548C;&#x603B;&#x9875;&#x6570;&#x548C;&#x914D;&#x7F6E;&#x7684;&#x6807;&#x7B7E;&#x751F;&#x6210;&#x5206;&#x9875;html&#x4EE3;&#x7801;</li>
</ul>
<h2 id="&#x8868;&#x5355;&#x9632;CSRF-Cross-site-request-forgery-&#x7684;&#x5B9E;&#x73B0;"><a href="#&#x8868;&#x5355;&#x9632;CSRF-Cross-site-request-forgery-&#x7684;&#x5B9E;&#x73B0;" class="headerlink" title="&#x8868;&#x5355;&#x9632;CSRF(Cross-site request forgery)&#x7684;&#x5B9E;&#x73B0;"></a>&#x8868;&#x5355;&#x9632;CSRF(Cross-site request forgery)&#x7684;&#x5B9E;&#x73B0;</h2><ul>
<li>&#x5728;&#x751F;&#x6210;&#x7684;&#x8868;&#x5355;&#x4E2D;&#x63D2;&#x5165;csrf key&#x9690;&#x85CF;&#x5B57;&#x6BB5;</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;input type=&quot;hidden&quot; name=&quot;post_hash&quot; value=&quot;&lt;?php echo new_post_hash(); ?&gt;&quot; /&gt;</div></pre></td></tr></table></figure>
<blockquote>
<p>system/functions.inc.php</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">function new_post_hash()</div><div class="line">{</div><div class="line">	if (! AWS_APP::session()-&gt;client_info)</div><div class="line">	{</div><div class="line">		return false;</div><div class="line">	}</div><div class="line"></div><div class="line">	return AWS_APP::form()-&gt;new_post_hash();</div><div class="line">}</div></pre></td></tr></table></figure>
<blockquote>
<p>system/core/form.php</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">public function __construct()</div><div class="line">{</div><div class="line">	$this-&gt;csrf_key = md5(G_COOKIE_HASH_KEY . $_SERVER[&apos;HTTP_USER_AGENT&apos;] . AWS_APP::user()-&gt;get_info(&apos;uid&apos;) . session_id());</div><div class="line">}</div><div class="line"></div><div class="line">public function new_post_hash()</div><div class="line">{</div><div class="line">	return $this-&gt;csrf_key;</div><div class="line">}</div></pre></td></tr></table></figure>
<p>&#x53EF;&#x89C1;&#xFF0C;&#x5047;&#x5982;session&#x6709;&#x6548;&#xFF0C;&#x6240;&#x6709;&#x8868;&#x5355;&#x8BF7;&#x6C42;csrf_key&#x90FD;&#x662F;&#x76F8;&#x540C;&#x7684;&#xFF0C;&#x56E0;&#x800C;&#x4E0D;&#x9700;&#x8981;&#x8003;&#x8651;csrf_key&#x7684;&#x5B58;&#x50A8;&#x548C;&#x6E05;&#x7406;&#x95EE;&#x9898;&#xFF0C;&#x662F;&#x4E00;&#x4E2A;&#x5F88;&#x53D6;&#x5DE7;&#x7684;&#x65B9;&#x6CD5;&#x3002;</p>
<ul>
<li>&#x5728;&#x8868;&#x5355;&#x5904;&#x7406;&#x7684;action&#x91CC;&#x9A8C;&#x8BC1;csrf key</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">if (!valid_post_hash($_POST[&apos;post_hash&apos;]))</div><div class="line">{</div><div class="line">	H::ajax_json_output(AWS_APP::RSM(null, &apos;-1&apos;, AWS_APP::lang()-&gt;_t(&apos;&#x9875;&#x9762;&#x505C;&#x7559;&#x65F6;&#x95F4;&#x8FC7;&#x957F;,&#x6216;&#x5185;&#x5BB9;&#x5DF2;&#x63D0;&#x4EA4;,&#x8BF7;&#x5237;&#x65B0;&#x9875;&#x9762;&apos;)));</div><div class="line">}</div></pre></td></tr></table></figure>
<blockquote>
<p>system/functions.inc.php</p>
</blockquote>
<p>function valid_post_hash($hash)<br>{<br>    return AWS_APP::form()-&gt;valid_post_hash($hash);<br>}</p>
<blockquote>
<p>system/core/form.php</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">public function valid_post_hash($post_hash)</div><div class="line">{</div><div class="line">	if ($post_hash == $this-&gt;csrf_key)</div><div class="line">	{</div><div class="line">		return TRUE;</div><div class="line">	}</div><div class="line"></div><div class="line">	return FALSE;</div><div class="line">}</div></pre></td></tr></table></figure>
<h2 id="&#x4E0A;&#x4F20;&#x56FE;&#x7247;&#x5E76;&#x751F;&#x6210;&#x7F29;&#x7565;&#x56FE;"><a href="#&#x4E0A;&#x4F20;&#x56FE;&#x7247;&#x5E76;&#x751F;&#x6210;&#x7F29;&#x7565;&#x56FE;" class="headerlink" title="&#x4E0A;&#x4F20;&#x56FE;&#x7247;&#x5E76;&#x751F;&#x6210;&#x7F29;&#x7565;&#x56FE;"></a>&#x4E0A;&#x4F20;&#x56FE;&#x7247;&#x5E76;&#x751F;&#x6210;&#x7F29;&#x7565;&#x56FE;</h2><p>&#x8FD9;&#x90E8;&#x5206;&#x4E3B;&#x8981;&#x7531;&#x4E24;&#x4E2A;&#x6A21;&#x5757;&#x5408;&#x529B;&#x5B8C;&#x6210;</p>
<ul>
<li>core_upload</li>
<li>core_image</li>
</ul>
<h3 id="&#x4E0A;&#x4F20;&#x56FE;&#x7247;"><a href="#&#x4E0A;&#x4F20;&#x56FE;&#x7247;" class="headerlink" title="&#x4E0A;&#x4F20;&#x56FE;&#x7247;"></a>&#x4E0A;&#x4F20;&#x56FE;&#x7247;</h3><h4 id="&#x4F7F;&#x7528;-1"><a href="#&#x4F7F;&#x7528;-1" class="headerlink" title="&#x4F7F;&#x7528;"></a>&#x4F7F;&#x7528;</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line">AWS_APP::upload()-&gt;initialize(array(</div><div class="line">    &apos;allowed_types&apos; =&gt; get_setting(&apos;allowed_upload_types&apos;),</div><div class="line">    &apos;upload_path&apos; =&gt; get_setting(&apos;upload_dir&apos;) . &apos;/&apos; . $item_type . &apos;/&apos; . gmdate(&apos;Ymd&apos;),</div><div class="line">    &apos;is_image&apos; =&gt; FALSE,</div><div class="line">    &apos;max_size&apos; =&gt; get_setting(&apos;upload_size_limit&apos;)</div><div class="line">));</div><div class="line"></div><div class="line">...</div><div class="line"></div><div class="line">AWS_APP::upload()-&gt;do_upload(&apos;qqfile&apos;);</div><div class="line"></div><div class="line">...</div><div class="line"></div><div class="line">if (AWS_APP::upload()-&gt;get_error())</div><div class="line">{</div><div class="line">    switch (AWS_APP::upload()-&gt;get_error())</div><div class="line">    {</div><div class="line">        default:</div><div class="line">        	H::ajax_json_output(AWS_APP::RSM(null, -1, AWS_APP::lang()-&gt;_t(&apos;&#x9519;&#x8BEF;&#x4EE3;&#x7801;: &apos;.AWS_APP::upload()-&gt;get_error())));</div><div class="line">        break;</div><div class="line"></div><div class="line">        case &apos;upload_invalid_filetype&apos;:</div><div class="line">            H::ajax_json_output(AWS_APP::RSM(null, -1, AWS_APP::lang()-&gt;_t(&apos;&#x6587;&#x4EF6;&#x7C7B;&#x578B;&#x65E0;&#x6548;&apos;)));</div><div class="line">        break;</div><div class="line"></div><div class="line">        case &apos;upload_invalid_filesize&apos;:</div><div class="line">           H::ajax_json_output(AWS_APP::RSM(null, -1, AWS_APP::lang()-&gt;_t(&quot;&#x6587;&#x4EF6;&#x5C3A;&#x5BF8;&#x8FC7;&#x5927;,&#x6700;&#x5927;&#x5141;&#x8BB8;&#x5C3A;&#x5BF8;&#x4E3A; &quot;.get_setting(&apos;upload_size_limit&apos;).&quot; KB&quot;)));</div><div class="line">        break;</div><div class="line">    }</div><div class="line">}</div><div class="line"></div><div class="line">if (! $upload_data = AWS_APP::upload()-&gt;data())</div><div class="line">{</div><div class="line">    H::ajax_json_output(AWS_APP::RSM(null, -1, AWS_APP::lang()-&gt;_t( &apos;&#x4E0A;&#x4F20;&#x5931;&#x8D25;, &#x8BF7;&#x4E0E;&#x7BA1;&#x7406;&#x5458;&#x8054;&#x7CFB;&apos; )));</div><div class="line">}</div></pre></td></tr></table></figure>
<p>&#x6B65;&#x9AA4;</p>
<ul>
<li>&#x521D;&#x59CB;&#x5316;&#xFF08;&#x63A5;&#x53D7;&#x7684;&#x6587;&#x4EF6;&#x7C7B;&#x578B;&#x3001;&#x4FDD;&#x5B58;&#x8DEF;&#x5F84;&#x3001;&#x662F;&#x5426;&#x5FC5;&#x987B;&#x662F;&#x56FE;&#x7247;&#x3001;&#x6700;&#x5927;&#x6587;&#x4EF6;&#x5C3A;&#x5BF8;&#xFF09;</li>
<li>&#x63A5;&#x53D7;&#x4E0A;&#x4F20;&#x6587;&#x4EF6;</li>
<li>&#x9519;&#x8BEF;&#x5904;&#x7406;</li>
</ul>
<h4 id="&#x5B9E;&#x73B0;-1"><a href="#&#x5B9E;&#x73B0;-1" class="headerlink" title="&#x5B9E;&#x73B0;"></a>&#x5B9E;&#x73B0;</h4><p>core_upload&#x5904;&#x7406;&#x6587;&#x4EF6;&#x4E0A;&#x4F20;&#xFF0C;&#x6DB5;&#x76D6;&#x4E86;</p>
<h4 id="&#x6587;&#x4EF6;&#x5B58;&#x50A8;&#x548C;&#x8BBF;&#x95EE;&#x66B4;&#x9732;"><a href="#&#x6587;&#x4EF6;&#x5B58;&#x50A8;&#x548C;&#x8BBF;&#x95EE;&#x66B4;&#x9732;" class="headerlink" title="&#x6587;&#x4EF6;&#x5B58;&#x50A8;&#x548C;&#x8BBF;&#x95EE;&#x66B4;&#x9732;"></a>&#x6587;&#x4EF6;&#x5B58;&#x50A8;&#x548C;&#x8BBF;&#x95EE;&#x66B4;&#x9732;</h4><p>&#x5148;&#x4F1A;&#x5C06;&#x6587;&#x4EF6;&#x5B58;&#x50A8;&#x5230;&#x4E34;&#x65F6;&#x6587;&#x4EF6;&#x4E2D;&#xFF0C;&#x5728;&#x5B8C;&#x6210;&#x540E;&#x9762;&#x7684;&#x68C0;&#x67E5;&#x540E;&#x518D;&#x79FB;&#x52A8;&#x5230;&#x76EE;&#x6807;&#x76EE;&#x5F55;</p>
<h4 id="&#x6587;&#x4EF6;&#x7C7B;&#x578B;&#x5224;&#x5B9A;&#x5E76;&#x53EA;&#x5141;&#x8BB8;&#x4E0A;&#x4F20;&#x5236;&#x5B9A;&#x7C7B;&#x578B;&#x7684;&#x6587;&#x4EF6;-mimes"><a href="#&#x6587;&#x4EF6;&#x7C7B;&#x578B;&#x5224;&#x5B9A;&#x5E76;&#x53EA;&#x5141;&#x8BB8;&#x4E0A;&#x4F20;&#x5236;&#x5B9A;&#x7C7B;&#x578B;&#x7684;&#x6587;&#x4EF6;-mimes" class="headerlink" title="&#x6587;&#x4EF6;&#x7C7B;&#x578B;&#x5224;&#x5B9A;&#x5E76;&#x53EA;&#x5141;&#x8BB8;&#x4E0A;&#x4F20;&#x5236;&#x5B9A;&#x7C7B;&#x578B;&#x7684;&#x6587;&#x4EF6;(mimes)"></a>&#x6587;&#x4EF6;&#x7C7B;&#x578B;&#x5224;&#x5B9A;&#x5E76;&#x53EA;&#x5141;&#x8BB8;&#x4E0A;&#x4F20;&#x5236;&#x5B9A;&#x7C7B;&#x578B;&#x7684;&#x6587;&#x4EF6;(mimes)</h4><p>&#x6839;&#x636E;&#x4E0A;&#x4F20;&#x6587;&#x4EF6;&#x7684;&#x6269;&#x5C55;&#x540D;&#x5224;&#x5B9A;&#x662F;&#x5426;&#x662F;allowed_types&#xFF0C;<br>&#x5982;&#x679C;&#x662F;&#x56FE;&#x7247;&#x6587;&#x4EF6;&#xFF0C;&#x8FD8;&#x4F1A;&#x5C1D;&#x8BD5;&#x83B7;&#x53D6;&#x56FE;&#x7247;&#x5C3A;&#x5BF8;&#xFF08;&#x5229;&#x7528;&#x83B7;&#x53D6;&#x56FE;&#x7247;&#x5927;&#x5C0F;&#x4F1A;&#x89E3;&#x6790;&#x56FE;&#x7247;&#x5934;&#x90E8;&#x4FE1;&#x606F;&#x7684;&#x526F;&#x4F5C;&#x7528;&#xFF09;<br>&#x53E6;&#x5916;&#x8FD8;&#x662F;&#x901A;&#x8FC7;&#x51FD;&#x6570;<code>finfo_file</code>&#x3001;<code>file</code>&#x547D;&#x4EE4;&#x6216;&#x8005;mime_content_type&#x6765;&#x5206;&#x6790;&#x6587;&#x4EF6;&#x7684;mimes type</p>
<blockquote>
<p>system/core/upload.php#file_mime_type</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">// We&apos;ll need this to validate the MIME info string (e.g. text/plain; charset=us-ascii)</div><div class="line">   $regexp = &apos;/^([a-z\-]+\/[a-z0-9\-\.\+]+)(;\s.+)?$/&apos;;</div></pre></td></tr></table></figure>
<ol>
<li><p>&#x4F18;&#x5148;&#x5148;&#x4F1A;&#x5C1D;&#x8BD5;&#x4F7F;&#x7528; &#xFF40;finfo_file&#xFF40;</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">/* Fileinfo extension - most reliable method</div><div class="line">    *</div><div class="line">    * Unfortunately, prior to PHP 5.3 - it&apos;s only available as a PECL extension and the</div><div class="line">    * more convenient FILEINFO_MIME_TYPE flag doesn&apos;t exist.</div><div class="line">    */</div><div class="line">   if (function_exists(&apos;finfo_file&apos;))</div><div class="line">   {</div><div class="line">       $finfo = finfo_open(FILEINFO_MIME);</div><div class="line">       if (is_resource($finfo)) // It is possible that a FALSE value is returned, if there is no magic MIME database file found on the system</div><div class="line">       {</div><div class="line">           $mime = @finfo_file($finfo, $file[&apos;tmp_name&apos;]);</div><div class="line">           finfo_close($finfo);</div><div class="line"></div><div class="line">           /* According to the comments section of the PHP manual page,</div><div class="line">            * it is possible that this function returns an empty string</div><div class="line">            * for some files (e.g. if they don&apos;t exist in the magic MIME database)</div><div class="line">            */</div><div class="line">           if (is_string($mime) &amp;&amp; preg_match($regexp, $mime, $matches))</div><div class="line">           {</div><div class="line">               $this-&gt;file_type = $matches[1];</div><div class="line">               return;</div><div class="line">           }</div><div class="line">       }</div><div class="line">   }</div></pre></td></tr></table></figure>
</li>
<li><p>&#x5176;&#x6B21;&#x662F;<code>file --brief --mime</code>&#x547D;&#x4EE4;</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div></pre></td><td class="code"><pre><div class="line">/* This is an ugly hack, but UNIX-type systems provide a &quot;native&quot; way to detect the file type,</div><div class="line">    * which is still more secure than depending on the value of $_FILES[$field][&apos;type&apos;], and as it</div><div class="line">    * was reported in issue #750 (https://github.com/EllisLab/CodeIgniter/issues/750) - it&apos;s better</div><div class="line">    * than mime_content_type() as well, hence the attempts to try calling the command line with</div><div class="line">    * three different functions.</div><div class="line">    *</div><div class="line">    * Notes:</div><div class="line">    *  - the DIRECTORY_SEPARATOR comparison ensures that we&apos;re not on a Windows system</div><div class="line">    *  - many system admins would disable the exec(), shell_exec(), popen() and similar functions</div><div class="line">    *    due to security concerns, hence the function_exists() checks</div><div class="line">    */</div><div class="line">   if (DIRECTORY_SEPARATOR !== &apos;\\&apos;)</div><div class="line">   {</div><div class="line">       $cmd = &apos;file --brief --mime &apos; . @escapeshellarg($file[&apos;tmp_name&apos;]) . &apos; 2&gt;&amp;1&apos;;</div><div class="line"></div><div class="line">       if (function_exists(&apos;exec&apos;))</div><div class="line">       {</div><div class="line">           /* This might look confusing, as $mime is being populated with all of the output when set in the second parameter.</div><div class="line">            * However, we only neeed the last line, which is the actual return value of exec(), and as such - it overwrites</div><div class="line">            * anything that could already be set for $mime previously. This effectively makes the second parameter a dummy</div><div class="line">            * value, which is only put to allow us to get the return status code.</div><div class="line">            */</div><div class="line">           $mime = @exec($cmd, $mime, $return_status);</div><div class="line">           if ($return_status === 0 &amp;&amp; is_string($mime) &amp;&amp; preg_match($regexp, $mime, $matches))</div><div class="line">           {</div><div class="line">               $this-&gt;file_type = $matches[1];</div><div class="line">               return;</div><div class="line">           }</div><div class="line">       }</div><div class="line"></div><div class="line">       if ( (bool) @ini_get(&apos;safe_mode&apos;) === FALSE &amp;&amp; function_exists(&apos;shell_exec&apos;))</div><div class="line">       {</div><div class="line">           $mime = @shell_exec($cmd);</div><div class="line">           if (strlen($mime) &gt; 0)</div><div class="line">           {</div><div class="line">               $mime = explode(&quot;\n&quot;, trim($mime));</div><div class="line">               if (preg_match($regexp, $mime[(count($mime) - 1)], $matches))</div><div class="line">               {</div><div class="line">                   $this-&gt;file_type = $matches[1];</div><div class="line">                   return;</div><div class="line">               }</div><div class="line">           }</div><div class="line">       }</div><div class="line"></div><div class="line">       if (function_exists(&apos;popen&apos;))</div><div class="line">       {</div><div class="line">           $proc = @popen($cmd, &apos;r&apos;);</div><div class="line">           if (is_resource($proc))</div><div class="line">           {</div><div class="line">               $mime = @fread($proc, 512);</div><div class="line">               @pclose($proc);</div><div class="line">               if ($mime !== FALSE)</div><div class="line">               {</div><div class="line">                   $mime = explode(&quot;\n&quot;, trim($mime));</div><div class="line">                   if (preg_match($regexp, $mime[(count($mime) - 1)], $matches))</div><div class="line">                   {</div><div class="line">                       $this-&gt;file_type = $matches[1];</div><div class="line">                       return;</div><div class="line">                   }</div><div class="line">               }</div><div class="line">           }</div><div class="line">       }</div><div class="line">   }</div></pre></td></tr></table></figure>
</li>
<li><p>&#x7136;&#x540E; <code>mime_content_type</code></p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">// Fall back to the deprecated mime_content_type(), if available (still better than $_FILES[$field][&apos;type&apos;])</div><div class="line">   if (function_exists(&apos;mime_content_type&apos;))</div><div class="line">   {</div><div class="line">       $this-&gt;file_type = @mime_content_type($file[&apos;tmp_name&apos;]);</div><div class="line">       if (strlen($this-&gt;file_type) &gt; 0) // It&apos;s possible that mime_content_type() returns FALSE or an empty string</div><div class="line">       {</div><div class="line">           return;</div><div class="line">       }</div><div class="line">   }</div></pre></td></tr></table></figure>
</li>
</ol>
<ol>
<li>&#x6700;&#x540E;&#x624D;&#x4F1A;&#x8003;&#x8651;&#x7528; <code>getimagesize</code> <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">if (function_exists(&apos;getimagesize&apos;))</div><div class="line">{</div><div class="line">    $imageinfo = @getimagesize($file[&apos;tmp_name&apos;]);</div><div class="line"></div><div class="line">    if ($imageinfo[&apos;mime&apos;])</div><div class="line">    {</div><div class="line">        $this-&gt;file_type = $imageinfo[&apos;mime&apos;];</div><div class="line"></div><div class="line">        return;</div><div class="line">    }</div><div class="line">}</div><div class="line"></div><div class="line">$this-&gt;file_type = $file[&apos;type&apos;];</div></pre></td></tr></table></figure>
</li>
</ol>
<h4 id="&#x6587;&#x4EF6;&#x5927;&#x5C0F;&#x68C0;&#x67E5;"><a href="#&#x6587;&#x4EF6;&#x5927;&#x5C0F;&#x68C0;&#x67E5;" class="headerlink" title="&#x6587;&#x4EF6;&#x5927;&#x5C0F;&#x68C0;&#x67E5;"></a>&#x6587;&#x4EF6;&#x5927;&#x5C0F;&#x68C0;&#x67E5;</h4><h4 id="&#x56FE;&#x7247;&#x5C3A;&#x5BF8;&#x68C0;&#x67E5;"><a href="#&#x56FE;&#x7247;&#x5C3A;&#x5BF8;&#x68C0;&#x67E5;" class="headerlink" title="&#x56FE;&#x7247;&#x5C3A;&#x5BF8;&#x68C0;&#x67E5;"></a>&#x56FE;&#x7247;&#x5C3A;&#x5BF8;&#x68C0;&#x67E5;</h4><h4 id="&#x6587;&#x4EF6;&#x540D;&#x548C;&#x6587;&#x4EF6;&#x5185;&#x5BB9;&#x5B89;&#x5168;&#x6821;&#x9A8C;&#xFF08;xss-clean&#xFF09;"><a href="#&#x6587;&#x4EF6;&#x540D;&#x548C;&#x6587;&#x4EF6;&#x5185;&#x5BB9;&#x5B89;&#x5168;&#x6821;&#x9A8C;&#xFF08;xss-clean&#xFF09;" class="headerlink" title="&#x6587;&#x4EF6;&#x540D;&#x548C;&#x6587;&#x4EF6;&#x5185;&#x5BB9;&#x5B89;&#x5168;&#x6821;&#x9A8C;&#xFF08;xss clean&#xFF09;"></a>&#x6587;&#x4EF6;&#x540D;&#x548C;&#x6587;&#x4EF6;&#x5185;&#x5BB9;&#x5B89;&#x5168;&#x6821;&#x9A8C;&#xFF08;xss clean&#xFF09;</h4><p>&#x4F1A;&#x53BB;&#x6389;&#x6587;&#x4EF6;&#x540D;&#x4E2D;&#x7684;&#x5404;&#x7C7B;&#x975E;&#x6CD5;&#x5B57;&#x7B26;</p>
<blockquote>
<p>system/core/upload.php#clean_file_name</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line"> $bad = array(</div><div class="line">                &quot;&lt;!--&quot;,</div><div class="line">                &quot;--&gt;&quot;,</div><div class="line">                &quot;&apos;&quot;,</div><div class="line">                &quot;&lt;&quot;,</div><div class="line">                &quot;&gt;&quot;,</div><div class="line">                &apos;&quot;&apos;,</div><div class="line">                &apos;&amp;&apos;,</div><div class="line">                &apos;$&apos;,</div><div class="line">                &apos;=&apos;,</div><div class="line">                &apos;;&apos;,</div><div class="line">                &apos;?&apos;,</div><div class="line">                &apos;/&apos;,</div><div class="line">                &quot;%20&quot;,</div><div class="line">                &quot;%22&quot;,</div><div class="line">                &quot;%3c&quot;,      // &lt;</div><div class="line">                &quot;%253c&quot;,    // &lt;</div><div class="line">                &quot;%3e&quot;,      // &gt;</div><div class="line">                &quot;%0e&quot;,      // &gt;</div><div class="line">                &quot;%28&quot;,      // (</div><div class="line">                &quot;%29&quot;,      // )</div><div class="line">                &quot;%2528&quot;,    // (</div><div class="line">                &quot;%26&quot;,      // &amp;</div><div class="line">                &quot;%24&quot;,      // $</div><div class="line">                &quot;%3f&quot;,      // ?</div><div class="line">                &quot;%3b&quot;,      // ;</div><div class="line">                &quot;%3d&quot;       // =</div><div class="line">            );</div><div class="line"></div><div class="line">$filename = str_replace($bad, &apos;&apos;, $filename);</div></pre></td></tr></table></figure>
<p><strong> &#x6587;&#x4EF6;&#x5185;&#x5BB9;&#x7684;xss clean </strong> </p>
<blockquote>
<p>system/core/upload.php#do_xss_clean</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div></pre></td><td class="code"><pre><div class="line">if (function_exists(&apos;memory_get_usage&apos;) &amp;&amp; memory_get_usage() &amp;&amp; ini_get(&apos;memory_limit&apos;) != &apos;&apos;)</div><div class="line">{</div><div class="line">    $current = ini_get(&apos;memory_limit&apos;) * 1024 * 1024;</div><div class="line"></div><div class="line">    // There was a bug/behavioural change in PHP 5.2, where numbers over one million get output</div><div class="line">    // into scientific notation.  number_format() ensures this number is an integer</div><div class="line">    // http://bugs.php.net/bug.php?id=43053</div><div class="line"></div><div class="line">    $new_memory = number_format(ceil(filesize($file) + $current), 0, &apos;.&apos;, &apos;&apos;);</div><div class="line"></div><div class="line">    @ini_set(&apos;memory_limit&apos;, $new_memory); // When an integer is used, the value is measured in bytes. - PHP.net</div><div class="line">}</div><div class="line"></div><div class="line">// If the file being uploaded is an image, then we should have no problem with XSS attacks (in theory), but</div><div class="line">// IE can be fooled into mime-type detecting a malformed image as an html file, thus executing an XSS attack on anyone</div><div class="line">// using IE who looks at the image.  It does this by inspecting the first 255 bytes of an image.  To get around this</div><div class="line">// CI will itself look at the first 255 bytes of an image to determine its relative safety.  This can save a lot of</div><div class="line">// processor power and time if it is actually a clean image, as it will be in nearly all instances _except_ an</div><div class="line">// attempted XSS attack.</div><div class="line"></div><div class="line">if (function_exists(&apos;getimagesize&apos;) &amp;&amp; @getimagesize($file) !== FALSE)</div><div class="line">{</div><div class="line">    if (($file = @fopen($file, &apos;rb&apos;)) === FALSE) // &quot;b&quot; to force binary</div><div class="line">    {</div><div class="line">        return FALSE; // Couldn&apos;t open the file, return FALSE</div><div class="line">    }</div><div class="line"></div><div class="line">    $opening_bytes = fread($file, 256);</div><div class="line">    fclose($file);</div><div class="line"></div><div class="line">    // These are known to throw IE into mime-type detection chaos</div><div class="line">    // &lt;a, &lt;body, &lt;head, &lt;html, &lt;img, &lt;plaintext, &lt;pre, &lt;script, &lt;table, &lt;title</div><div class="line">    // title is basically just in SVG, but we filter it anyhow</div><div class="line"></div><div class="line">    if ( ! preg_match(&apos;/&lt;(a|body|head|html|img|plaintext|pre|script|table|title)[\s&gt;]/i&apos;, $opening_bytes))</div><div class="line">    {</div><div class="line">        return TRUE; // its an image, no &quot;triggers&quot; detected in the first 256 bytes, we&apos;re good</div><div class="line">    }</div><div class="line">    else</div><div class="line">    {</div><div class="line">        return FALSE;</div><div class="line">    }</div><div class="line">}</div><div class="line"></div><div class="line">if (($data = @file_get_contents($file)) === FALSE)</div><div class="line">{</div><div class="line">    return FALSE;</div><div class="line">}</div><div class="line"></div><div class="line">return $data;</div></pre></td></tr></table></figure>
<p>&#x5904;&#x7406;&#x6B65;&#x9AA4;</p>
<ol>
<li>&#x8C03;&#x6574;&#x5185;&#x5B58;<code>memory_limit</code>&#x4E3A;&#x8BFB;&#x5165;&#x6587;&#x4EF6;&#x4FDD;&#x7559;&#x8DB3;&#x591F;&#x7684;&#x5185;&#x5B58;</li>
<li>&#x5982;&#x679C;&#x662F;&#x56FE;&#x7247;&#x6587;&#x4EF6;&#xFF0C;&#x8981;&#x6C42;&#x6587;&#x4EF6;&#x4E0D;&#x80FD;&#x6709;&#x4EFB;&#x4F55;html&#x6807;&#x7B7E;&#xFF08;<code>a|body|head|html|img|plaintext|pre|script|table|title</code>&#xFF09;</li>
<li>&#x5982;&#x679C;&#x4E0D;&#x662F;&#x56FE;&#x7247;&#xFF0C;&#x53EA;&#x8981;&#x4E0D;&#x4E3A;&#x7A7A;&#x5373;&#x53EF;&#x3002;</li>
</ol>
<h3 id="&#x751F;&#x6210;&#x7F29;&#x7565;&#x56FE;&#x7B97;&#x6CD5;"><a href="#&#x751F;&#x6210;&#x7F29;&#x7565;&#x56FE;&#x7B97;&#x6CD5;" class="headerlink" title="&#x751F;&#x6210;&#x7F29;&#x7565;&#x56FE;&#x7B97;&#x6CD5;"></a>&#x751F;&#x6210;&#x7F29;&#x7565;&#x56FE;&#x7B97;&#x6CD5;</h3><h4 id="&#x4F7F;&#x7528;-2"><a href="#&#x4F7F;&#x7528;-2" class="headerlink" title="&#x4F7F;&#x7528;"></a>&#x4F7F;&#x7528;</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">AWS_APP::image()-&gt;initialize(array(</div><div class="line">    &apos;quality&apos; =&gt; 90,</div><div class="line">    &apos;source_image&apos; =&gt; $upload_data[&apos;full_path&apos;],</div><div class="line">    &apos;new_image&apos; =&gt; $thumb_file[$key],</div><div class="line">    &apos;width&apos; =&gt; $val[&apos;w&apos;],</div><div class="line">    &apos;height&apos; =&gt; $val[&apos;h&apos;]</div><div class="line">))-&gt;resize();</div></pre></td></tr></table></figure>
<p>core_image&#x8D1F;&#x8D23;&#x7F29;&#x7565;&#x56FE;&#x7684;&#x751F;&#x6210;</p>
<ul>
<li>&#x751F;&#x6210;&#x6307;&#x5B9A;&#x5927;&#x5C0F;&#x7684;&#x7F29;&#x7565;&#x56FE;&#xFF08;resize&#xFF09;</li>
<li>&#x53EF;&#x4EE5;&#x9009;&#x62E9;&#x8F93;&#x51FA;&#x5230;&#x6587;&#x4EF6;&#x6216;&#x8005;&#x6D4F;&#x89C8;&#x5668;</li>
</ul>
<p>resize&#x7684;&#x7B97;&#x6CD5;&#x652F;&#x6301;&#x7F29;&#x653E;&#x548C;&#x88C1;&#x526A;&#xFF0C;&#x5E76;&#x652F;&#x6301;&#x538B;&#x7F29;&#x5230;&#x4E00;&#x5B9A;&#x6E05;&#x6670;&#x5EA6;</p>
<p><strong> &#x7F29;&#x653E; </strong></p>
<ul>
<li><p>IMAGE_CORE_SC_NOT_KEEP_SCALE </p>
<p>  &#x76F4;&#x63A5;&#x7F29;&#x653E;&#x6216;&#x62C9;&#x4F38;&#xFF0C;&#x4E0D;&#x8003;&#x8651;&#x6BD4;&#x4F8B;</p>
</li>
<li><p>IMAGE_CORE_SC_BEST_RESIZE_WIDTH</p>
<p>  &#x4F18;&#x5148;&#x5339;&#x914D;&#x7F29;&#x653E;&#x540E;&#x7684;&#x76EE;&#x6807;&#x5BBD;&#x5EA6;</p>
</li>
<li><p>IMAGE_CORE_SC_BEST_RESIZE_HEIGHT</p>
<p>  &#x9AD8;&#x5EA6;&#x4F18;&#x5148;&#x5339;&#x914D;</p>
</li>
</ul>
<p><strong> &#x88C1;&#x526A; </strong></p>
<ul>
<li><p>IMAGE_CORE_CM_DEFAULT</p>
<p>  &#x4E0D;&#x88C1;&#x526A;</p>
</li>
<li><p>IMAGE_CORE_CM_LEFT_OR_TOP</p>
<p>  &#x5BF9;&#x9F50;&#x5DE6;&#x4E0A;&#x89D2;&#xFF0C;&#x88C1;&#x526A;&#x53F3;&#x4E0B;&#x89D2;</p>
</li>
<li><p>IMAGE_CORE_CM_MIDDLE    </p>
<p>  &#x5C45;&#x4E2D;&#x5BF9;&#x9F50;&#xFF0C;&#x88C1;&#x526A;&#x56DB;&#x5468;</p>
</li>
<li><p>IMAGE_CORE_CM_RIGHT_OR_BOTTOM</p>
<p>  &#x53F3;&#x4E0B;&#x89D2;&#x5BF9;&#x9F50;&#xFF0C;&#x88C1;&#x526A;&#x5DE6;&#x4E0A;&#x89D2;</p>
</li>
</ul>
<h4 id="&#x5B9E;&#x73B0;-2"><a href="#&#x5B9E;&#x73B0;-2" class="headerlink" title="&#x5B9E;&#x73B0;"></a>&#x5B9E;&#x73B0;</h4><p>&#x5185;&#x90E8;&#x652F;&#x6301;<code>GD</code>&#x6216;<code>ImageMagick</code>&#x6765;&#x5904;&#x7406;&#x56FE;&#x7247;&#xFF0C;&#x652F;&#x6301;<code>jpg/png/gif</code>&#x4E09;&#x79CD;&#x683C;&#x5F0F;&#x7684;&#x56FE;&#x7247;&#x5904;&#x7406;&#x3002;</p>
<p>&#x5904;&#x7406;&#x6B65;&#x9AA4;&#xFF1A;</p>
<ol>
<li><p>&#x6839;&#x636E;&#x56FE;&#x7247;&#x7684;&#x5BBD;&#x7A84;&#x6BD4;&#x8BA1;&#x7B97;&#x76EE;&#x6807;&#x7F29;&#x653E;&#x533A;&#x57DF;&#xFF08;&#x4F18;&#x5148;&#x6309;&#x957F;&#x8FB9;&#x7F29;&#x653E;&#xFF09;</p>
<blockquote>
<p>system/core/image.php#imageProcessImageMagick</p>
</blockquote>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">if ($this-&gt;source_image_w * $this-&gt;height &gt; $this-&gt;source_image_h * $this-&gt;width)</div><div class="line">{</div><div class="line">	$match_w = round($this-&gt;width * $this-&gt;source_image_h / $this-&gt;height);</div><div class="line">	$match_h = $this-&gt;source_image_h;</div><div class="line">}</div><div class="line">else</div><div class="line">{</div><div class="line">	$match_h = round($this-&gt;height * $this-&gt;source_image_w / $this-&gt;width);</div><div class="line">	$match_w = $this-&gt;source_image_w;</div><div class="line">}</div></pre></td></tr></table></figure>
</li>
</ol>
<ol>
<li><p>&#x6839;&#x636E;&#x88C1;&#x526A;&#x9700;&#x6C42;&#xFF0C;&#x8BBE;&#x5B9A;&#x76EE;&#x6807;&#x533A;&#x57DF;</p>
<blockquote>
<p>system/core/image.php#imageProcessImageMagick</p>
</blockquote>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">switch ($this-&gt;clipping)</div><div class="line">{</div><div class="line">	case IMAGE_CORE_CM_LEFT_OR_TOP:</div><div class="line">		$this-&gt;source_image_x = 0;</div><div class="line">		$this-&gt;source_image_y = 0;</div><div class="line">	break;</div><div class="line"></div><div class="line">	case IMAGE_CORE_CM_MIDDLE:</div><div class="line">		$this-&gt;source_image_x = round(($this-&gt;source_image_w - $match_w) / 2);</div><div class="line">		$this-&gt;source_image_y = round(($this-&gt;source_image_h - $match_h) / 2);</div><div class="line">	break;</div><div class="line"></div><div class="line">	case IMAGE_CORE_CM_RIGHT_OR_BOTTOM:</div><div class="line">		$this-&gt;source_image_x = $this-&gt;source_image_w - $match_w;</div><div class="line">		$this-&gt;source_image_y = $this-&gt;source_image_h - $match_h;</div><div class="line">	break;</div><div class="line">}</div><div class="line"></div><div class="line">$this-&gt;source_image_w = $match_w;</div><div class="line">$this-&gt;source_image_h = $match_h;</div><div class="line">$this-&gt;source_image_x += $this-&gt;start_x;</div><div class="line">$this-&gt;source_image_y += $this-&gt;start_y;</div></pre></td></tr></table></figure>
</li>
</ol>
<ol>
<li><p>&#x6839;&#x636E;&#x7F29;&#x653E;&#x8BBE;&#x7F6E;&#xFF0C;&#x8BA1;&#x7B97;&#x51FA;&#x76EE;&#x6807;&#x56FE;&#x7247;&#x7684;&#x771F;&#x5B9E;&#x5C3A;&#x5BF8;</p>
<blockquote>
<p>system/core/image.php#imageProcessImageMagick</p>
</blockquote>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">$resize_height = $this-&gt;height;</div><div class="line">$resize_width = $this-&gt;width;</div><div class="line"></div><div class="line">if ($this-&gt;scale != IMAGE_CORE_SC_NOT_KEEP_SCALE)</div><div class="line">{</div><div class="line">	if ($this-&gt;scale == IMAGE_CORE_SC_BEST_RESIZE_WIDTH)</div><div class="line">	{</div><div class="line">		$resize_height = round($this-&gt;width * $this-&gt;source_image_h / $this-&gt;source_image_w);</div><div class="line">		$resize_width = $this-&gt;width;</div><div class="line">	}</div><div class="line">	else if ($this-&gt;scale == IMAGE_CORE_SC_BEST_RESIZE_HEIGHT)</div><div class="line">	{</div><div class="line">		$resize_width = round($this-&gt;height * $this-&gt;source_image_w / $this-&gt;source_image_h);</div><div class="line">		$resize_height = $this-&gt;height;</div><div class="line">	}</div><div class="line">}</div></pre></td></tr></table></figure>
</li>
<li><p>&#x6309;&#x76EE;&#x6807;&#x533A;&#x57DF;&#x88C1;&#x526A;&#x56FE;&#x7247;</p>
</li>
<li>&#x7F29;&#x653E;&#x56FE;&#x7247;&#x5230;&#x76EE;&#x6807;&#x5C3A;&#x5BF8;  </li>
<li>&#x8F93;&#x51FA;&#x56FE;&#x7247;</li>
</ol>
<p>&#x5177;&#x4F53;&#x5230;&#x56FE;&#x7247;&#x5904;&#x7406;&#x8BB0;&#x5F97;&#xFF0C;&#x6839;&#x636E;&#x5E93;&#x7684;&#x4E0D;&#x540C;&#xFF0C;&#x7565;&#x6709;&#x4E0D;&#x540C;</p>
<p><strong> imagemagick </strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">$im = new Imagick();</div><div class="line"></div><div class="line">$im-&gt;readimageblob(file_get_contents($this-&gt;source_image));</div><div class="line"></div><div class="line">$im-&gt;setCompressionQuality($this-&gt;quality);</div><div class="line"></div><div class="line">if ($this-&gt;source_image_x OR $this-&gt;source_image_y)</div><div class="line">{</div><div class="line">	$im-&gt;cropImage($this-&gt;source_image_w, $this-&gt;source_image_h, $this-&gt;source_image_x, $this-&gt;source_image_y);</div><div class="line">}</div><div class="line"></div><div class="line">$im-&gt;thumbnailImage($resize_width, $resize_height, true);</div><div class="line"></div><div class="line">if ($this-&gt;option == IMAGE_CORE_OP_TO_FILE AND $this-&gt;new_image)</div><div class="line">{</div><div class="line">	file_put_contents($this-&gt;new_image, $im-&gt;getimageblob());</div><div class="line">}</div><div class="line">else if ($this-&gt;option == IMAGE_CORE_OP_OUTPUT)</div><div class="line">{</div><div class="line">	$output = $im-&gt;getimageblob();</div><div class="line">			$outputtype = $im-&gt;getFormat();</div><div class="line"></div><div class="line">	header(&quot;Content-type: $outputtype&quot;);</div><div class="line">	echo $output;</div><div class="line">	die;</div><div class="line">}</div></pre></td></tr></table></figure>
<p><strong> gd </strong></p>
<p>&#x901A;&#x8FC7; <code>imagecopyresampled</code>&#x6216;<code>imagecopyresized</code>&#x53EF;&#x4EE5;&#x4E00;&#x6B65;&#x4F5C;&#x4E3A;&#x88C1;&#x526A;&#x548C;&#x7F29;&#x653E;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$func_resize($dst_img, $im, $dst_x, $dst_y, $this-&gt;source_image_x, $this-&gt;source_image_y, $fdst_w, $fdst_h, $this-&gt;source_image_w, $this-&gt;source_image_h);</div></pre></td></tr></table></figure>
<h2 id="&#x5BF9;&#x79F0;&#x52A0;&#x5BC6;"><a href="#&#x5BF9;&#x79F0;&#x52A0;&#x5BC6;" class="headerlink" title="&#x5BF9;&#x79F0;&#x52A0;&#x5BC6;"></a>&#x5BF9;&#x79F0;&#x52A0;&#x5BC6;</h2><h3 id="php&#x5BF9;&#x79F0;&#x52A0;&#x5BC6;&#x4ECB;&#x7ECD;"><a href="#php&#x5BF9;&#x79F0;&#x52A0;&#x5BC6;&#x4ECB;&#x7ECD;" class="headerlink" title="php&#x5BF9;&#x79F0;&#x52A0;&#x5BC6;&#x4ECB;&#x7ECD;"></a>php&#x5BF9;&#x79F0;&#x52A0;&#x5BC6;&#x4ECB;&#x7ECD;</h3><blockquote>
<p>&#x53C2;&#x7167; <a href="https://zh.wikipedia.org/wiki/%E5%9D%97%E5%AF%86%E7%A0%81%E7%9A%84%E5%B7%A5%E4%BD%9C%E6%A8%A1%E5%BC%8F" target="_blank" rel="external">&#x5757;&#x5BC6;&#x7801;&#x7684;&#x5DE5;&#x4F5C;&#x65B9;&#x5F0F;</a></p>
</blockquote>
<p>&#x57FA;&#x672C;&#x7684;&#x601D;&#x8DEF;:</p>
<ol>
<li><p>&#x5C06;&#x6570;&#x636E;&#x5207;&#x5206;&#x6210;&#x56FA;&#x5B9A;&#x5927;&#x5C0F;&#x7684;&#x6570;&#x636E;&#x5757;(&#x5206;&#x7EC4;)&#x5904;&#x7406;</p>
<p> &#x5BF9;&#x786E;&#x5B9A;&#x957F;&#x5EA6;&#x7684;&#x5206;&#x7EC4;&#x6570;&#x636E;&#x5904;&#x7406;&#x65F6;&#xFF08;ECB/CBC&#xFF09;&#xFF0C;&#x5982;&#x679C;&#x6700;&#x540E;&#x4E00;&#x5757;&#x7684;&#x6570;&#x636E;&#x4E0D;&#x8DB3;&#x4E00;&#x5757;&#xFF08;16&#x5B57;&#x8282;&#xFF09;&#xFF0C;&#x9700;&#x8981;&#x8FDB;&#x884C;<code>&#x586B;&#x5145;</code>&#xFF0C;&#x6BD4;&#x5982;</p>
<blockquote>
<p><code>PKCS#5</code></p>
<ul>
<li>&#x5728;&#x6700;&#x540E;&#x4E00;&#x5757;&#x672B;&#x5C3E;&#x586B;&#x5145;5&#x4E2A;&#x5B57;&#x8282;&#x7684;0x05(&#x586B;&#x5145;&#x7684;&#x5B57;&#x8282;&#x90FD;&#x662F;&#x4E00;&#x4E2A;&#x76F8;&#x540C;&#x7684;&#x5B57;&#x8282;&#xFF0C;&#x8BE5;&#x5B57;&#x8282;&#x7684;&#x503C;,&#x5C31;&#x662F;&#x8981;&#x586B;&#x5145;&#x7684;&#x5B57;&#x8282;&#x7684;&#x4E2A;&#x6570;)</li>
<li>&#x5982;&#x679C;&#x6570;&#x636E;&#x521A;&#x597D;&#x4E00;&#x5757;&#x6570;&#x636E;&#xFF0C;&#x5219;&#x9644;&#x52A0;&#x4E00;&#x6574;&#x5757;&#x7684;0xFF(16&#x5B57;&#x8282;&#x7684;&#x586B;&#x5145;Ox10)</li>
</ul>
</blockquote>
</li>
</ol>
<ol>
<li>&#x6839;&#x636E;&#x4E0D;&#x540C;&#x7684;&#x52A0;&#x5BC6;&#x6A21;&#x5F0F;&#x548C;&#x7B97;&#x6CD5;&#x5BF9;&#x6570;&#x636E;&#x5757;&#x52A0;&#x5BC6;</li>
</ol>
<p>wecenter&#x5C06;&#x7528;&#x6237;&#x4FE1;&#x606F;&#xFF08;uid&#x3001;&#x7528;&#x6237;&#x540D;&#x3001;&#x5BC6;&#x7801;&#xFF09;&#x901A;&#x8FC7;&#x5BF9;&#x79F0;&#x52A0;&#x5BC6;&#x7684;&#x65B9;&#x5F0F;&#x5B58;&#x50A8;&#x5230;cookie&#x4E2D;&#x3002;</p>
<p><strong> &#x652F;&#x6301;&#x5404;&#x79CD;&#x52A0;&#x5BC6;&#x6A21;&#x5F0F; </strong></p>
<p>&#x9664;ECB&#x548C;CBC&#x662F;&#x56FA;&#x5B9A;&#x5757;&#x957F;&#x5EA6;&#x52A0;&#x5BC6;&#x5916;&#xFF0C;&#x5176;&#x5B83;&#x7684;&#xFF08;CFB/OFB/CTR&#xFF09;&#x90FD;&#x662F;&#x53EF;&#x53D8;&#x5757;&#x957F;&#x5EA6;&#x52A0;&#x5BC6;&#x3002;</p>
<ul>
<li><p>MCRYPTE_MODEL_ECB(Electronic codebook&#xFF0C;&#x7535;&#x5B50;&#x5BC6;&#x7801;&#x672C;)</p>
<p>  &#x6570;&#x636E;&#x5757;&#x5404;&#x81EA;&#x52A0;&#x5BC6;&#xFF0C;&#x6570;&#x636E;&#x5757;&#x76F4;&#x63A5;&#x4E92;&#x4E0D;&#x76F8;&#x5173;</p>
<p>  &#x4F18;&#x70B9;:</p>
<ol>
<li>&#x7B80;&#x5355;&#xFF1B;</li>
<li>&#x6709;&#x5229;&#x4E8E;&#x5E76;&#x884C;&#x8BA1;&#x7B97;&#xFF1B;</li>
<li><p>&#x8BEF;&#x5DEE;&#x4E0D;&#x4F1A;&#x88AB;&#x4F20;&#x9001;&#xFF1B;</p>
<p>&#x7F3A;&#x70B9;:</p>
</li>
<li>&#x4E0D;&#x80FD;&#x9690;&#x85CF;&#x660E;&#x6587;&#x7684;&#x6A21;&#x5F0F;&#xFF1B;</li>
<li>&#x53EF;&#x80FD;&#x5BF9;&#x660E;&#x6587;&#x8FDB;&#x884C;&#x4E3B;&#x52A8;&#x653B;&#x51FB;&#xFF1B;</li>
</ol>
</li>
<li><p>MCRYPTE_MODEL_CBC(Cipher-block chaining&#xFF0C;&#x5BC6;&#x7801;&#x5757;&#x94FE;)</p>
<p>  &#x4E0A;&#x4E00;&#x5757;&#x7684;&#x5BC6;&#x6587;&#x5757;&#x548C;&#x5F53;&#x524D;&#x660E;&#x6587;&#x5757;&#x505A;xor&#x8FD0;&#x7B97;&#x540E;&#x518D;&#x505A;&#x52A0;&#x5BC6;<br>  &#x4F18;&#x70B9;&#xFF1A;</p>
<ol>
<li><p>&#x4E0D;&#x5BB9;&#x6613;&#x4E3B;&#x52A8;&#x653B;&#x51FB;,&#x5B89;&#x5168;&#x6027;&#x597D;&#x4E8E;ECB,&#x9002;&#x5408;&#x4F20;&#x8F93;&#x957F;&#x5EA6;&#x957F;&#x7684;&#x62A5;&#x6587;,&#x662F;SSL&#x3001;IPSec&#x7684;&#x6807;&#x51C6;&#x3002;</p>
<p>&#x7F3A;&#x70B9;&#xFF1A;</p>
</li>
<li>&#x4E0D;&#x5229;&#x4E8E;&#x5E76;&#x884C;&#x8BA1;&#x7B97;&#xFF1B;</li>
<li>&#x8BEF;&#x5DEE;&#x4F20;&#x9012;&#xFF1B;</li>
<li>&#x9700;&#x8981;&#x521D;&#x59CB;&#x5316;&#x5411;&#x91CF;IV</li>
</ol>
</li>
<li><p>MCRYPTE_MODEL_CFB&#xFF08;Cipher feedback&#xFF0C;&#x5BC6;&#x7801;&#x53CD;&#x9988;&#xFF09;</p>
<p>  &#x5C06;&#x524D;&#x4E00;&#x5757;&#x52A0;&#x5BC6;&#x540E;&#x8F93;&#x51FA;&#x548C;&#x5F53;&#x524D;&#x660E;&#x6587;&#x5757;&#x505A;xor&#x8FD0;&#x7B97;&#x540E;&#x5F62;&#x6210;&#x65B0;&#x7684;&#x5BC6;&#x6587;&#x6D41;&#x5165;&#x4E0B;&#x4E00;&#x5757;&#x7684;&#x52A0;&#x5BC6;&#x8FC7;&#x7A0B;</p>
<p>  &#x4F18;&#x70B9;&#xFF1A;</p>
<ol>
<li>&#x9690;&#x85CF;&#x4E86;&#x660E;&#x6587;&#x6A21;&#x5F0F;;</li>
<li>&#x5206;&#x7EC4;&#x5BC6;&#x7801;&#x8F6C;&#x5316;&#x4E3A;&#x6D41;&#x6A21;&#x5F0F;;</li>
<li><p>&#x53EF;&#x4EE5;&#x53CA;&#x65F6;&#x52A0;&#x5BC6;&#x4F20;&#x9001;&#x5C0F;&#x4E8E;&#x5206;&#x7EC4;&#x7684;&#x6570;&#x636E;;</p>
<p>&#x7F3A;&#x70B9;:</p>
</li>
<li>&#x4E0D;&#x5229;&#x4E8E;&#x5E76;&#x884C;&#x8BA1;&#x7B97;;</li>
<li>&#x8BEF;&#x5DEE;&#x4F20;&#x9001;&#xFF1A;&#x4E00;&#x4E2A;&#x660E;&#x6587;&#x5355;&#x5143;&#x635F;&#x574F;&#x5F71;&#x54CD;&#x591A;&#x4E2A;&#x5355;&#x5143;;</li>
<li>&#x552F;&#x4E00;&#x7684;IV;</li>
</ol>
</li>
<li><p>MCRYPTE_MODEL_NCFB&#xFF08;N bits Cipher feedback&#xFF0C; N&#x4F4D;&#x5BC6;&#x7801;&#x53CD;&#x9988;&#x6A21;&#x5F0F;&#xFF09;</p>
<p>  &#x4E0E;CFB&#x8FC7;&#x7A0B;&#x4E00;&#x6837;&#xFF0C;&#x53EA;&#x662F;&#x6BCF;&#x6B21;&#x4EC5;&#x5C06;&#x524D;&#x4E00;&#x5757;&#x52A0;&#x5BC6;&#x540E;&#x8F93;&#x51FA;&#x7684;&#x9AD8;n&#x4F4D;&#x548C;&#x5F53;&#x524D;&#x660E;&#x6587;&#x5757;&#x9AD8;n&#x4F4D;xor</p>
</li>
<li><p>MCRYPTE_MODEL_OFB&#xFF08;Output Feedback, &#x8F93;&#x51FA;&#x53CD;&#x9988;&#x6A21;&#x5F0F;&#xFF09;</p>
<p>  &#x5C06;&#x524D;&#x4E00;&#x5757;&#x7684;&#x52A0;&#x5BC6;&#x540E;&#x7684;&#x8F93;&#x51FA;&#x6D41;&#x5165;&#x4E0B;&#x4E00;&#x5757;&#x7684;&#x52A0;&#x5BC6;&#x8FC7;&#x7A0B;&#xFF0C;&#x800C;&#x5C06;&#x660E;&#x6587;&#x5757;&#x548C;&#x52A0;&#x5BC6;&#x540E;&#x7684;&#x8F93;&#x51FA;&#x505A;xor&#x4F5C;&#x4E3A;&#x5BC6;&#x6587;&#x5757;     </p>
</li>
<li><p>MCRYPTE_MODEL_NOFB(N bits output feedback, N&#x4F4D;&#x8F93;&#x51FA;&#x53CD;&#x9988;&#x6A21;&#x5F0F;)</p>
<p>  &#x4E0E;NOFB&#x8FC7;&#x7A0B;&#x4E00;&#x6837;&#xFF0C;&#x53EA;&#x662F;&#x6BCF;&#x6B21;&#x4EC5;&#x5C06;&#x524D;&#x4E00;&#x5757;&#x52A0;&#x5BC6;&#x540E;&#x8F93;&#x51FA;&#x7684;&#x9AD8;n&#x4F4D;&#x6D41;&#x5165;&#x4E0B;&#x4E2A;&#x8FC7;&#x7A0B;</p>
</li>
<li><p>MCRYPTE_MODEL_CTR  </p>
<p>  &#x5148;&#x5C06;&#x4E00;&#x4E2A;&#x81EA;&#x589E;&#x7684;&#x7B97;&#x5B50;&#x52A0;&#x5BC6;&#xFF0C;&#x7136;&#x540E;&#x5C06;&#x5BC6;&#x6587;&#x4E0E;&#x660E;&#x6587;&#x505A;xor&#xFF0C;&#x8FD9;&#x6837;&#x76F8;&#x5F53;&#x4E8E;&#x6BCF;&#x6B21;&#x79D8;&#x94A5;&#x90FD;&#x4E0D;&#x4E00;&#x6837;&#x3002;</p>
</li>
<li><p>MCRYPTE_MODEL_STREAM</p>
<p>  !!! &#x6CA1;&#x6709;&#x641E;&#x6E05;&#x695A;</p>
</li>
</ul>
<p><strong> PHP&#x901A;&#x8FC7;<code>mcrypt</code>&#x52A0;&#x5BC6;&#x6269;&#x5C55;&#x51FD;&#x6570;&#xFF0C;&#x53EF;&#x4EE5;&#x652F;&#x6301;&#x5404;&#x79CD;&#x52A0;&#x5BC6;&#x7B97;&#x6CD5; </strong></p>
<blockquote>
<p>MCRYPT_ciphername</p>
</blockquote>
<ul>
<li>des</li>
<li>rc2</li>
<li>cast-128</li>
<li>cast-256 </li>
<li>gost </li>
<li>rijndael-128 </li>
<li>rijndael-192</li>
<li>rijndael-256</li>
<li>twofish </li>
<li>arcfour </li>
<li>loki97 </li>
<li>saferplus </li>
<li>wake   </li>
<li>serpent </li>
<li>xtea </li>
<li>blowfish </li>
<li>blowfish-compat </li>
<li>enigma  </li>
<li>tripledes</li>
</ul>
<h3 id="mcrypt&#x4F7F;&#x7528;"><a href="#mcrypt&#x4F7F;&#x7528;" class="headerlink" title="mcrypt&#x4F7F;&#x7528;"></a>mcrypt&#x4F7F;&#x7528;</h3><p><strong> &#x52A0;&#x5BC6; </strong></p>
<blockquote>
<p>system/core/crypte.php#encode</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">public function encode($data, $key = null)</div><div class="line">{</div><div class="line">    $mcrypt = mcrypt_module_open($this-&gt;get_algorithms(), &apos;&apos;, MCRYPT_MODE_ECB, &apos;&apos;);</div><div class="line"></div><div class="line">    mcrypt_generic_init($mcrypt, $this-&gt;get_key($mcrypt, $key), mcrypt_create_iv(mcrypt_enc_get_iv_size($mcrypt), MCRYPT_RAND));</div><div class="line"></div><div class="line">    $result = mcrypt_generic($mcrypt, gzcompress($data));</div><div class="line"></div><div class="line">    mcrypt_generic_deinit($mcrypt);</div><div class="line">    mcrypt_module_close($mcrypt);</div><div class="line"></div><div class="line">    return $this-&gt;get_algorithms() . &apos;|&apos; . $this-&gt;str_to_hex($result);</div><div class="line">}</div></pre></td></tr></table></figure>
<p>&#x6B65;&#x9AA4;&#xFF1A;</p>
<ol>
<li>&#x6839;&#x636E;&#x52A0;&#x5BC6;&#x7B97;&#x6CD5;&#x548C;&#x52A0;&#x5BC6;&#x6A21;&#x5F0F;&#x83B7;&#x53D6;&#x52A0;&#x5BC6;&#x6A21;&#x5757;</li>
<li>&#x521D;&#x59CB;&#x5316;&#x968F;&#x673A;&#x5411;&#x91CF;</li>
<li>&#x521D;&#x59CB;&#x5316;&#x52A0;&#x5BC6;&#x5668;</li>
<li>&#x52A0;&#x5BC6;</li>
<li>&#x91CA;&#x653E;&#x8D44;&#x6E90;</li>
<li>&#x5173;&#x95ED;&#x52A0;&#x5BC6;&#x6A21;&#x5757;</li>
</ol>
<p>** &#x89E3;&#x5BC6;</p>
<blockquote>
<p>system/core/crypte.php#decode</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line">public function decode($data, $key = null)</div><div class="line">{</div><div class="line">   if (strstr($data, &apos;|&apos;))</div><div class="line">   {</div><div class="line">		$decode_data = explode(&apos;|&apos;, $data);</div><div class="line"></div><div class="line">		$algorithm = $decode_data[0];</div><div class="line"></div><div class="line">       $data = str_replace($algorithm . &apos;|&apos;, &apos;&apos;, $data);</div><div class="line"></div><div class="line">       $data = $this-&gt;hex_to_str($data);</div><div class="line">   }</div><div class="line">   else</div><div class="line">   {</div><div class="line">       $algorithm = $this-&gt;get_algorithms();</div><div class="line"></div><div class="line">       $data = base64_decode($data);</div><div class="line">   }</div><div class="line"></div><div class="line">   $mcrypt = mcrypt_module_open($algorithm, &apos;&apos;, MCRYPT_MODE_ECB, &apos;&apos;);</div><div class="line"></div><div class="line">   mcrypt_generic_init($mcrypt, $this-&gt;get_key($mcrypt, $key), mcrypt_create_iv(mcrypt_enc_get_iv_size($mcrypt), MCRYPT_RAND));</div><div class="line"></div><div class="line">   $result = trim(mdecrypt_generic($mcrypt, $data));</div><div class="line"></div><div class="line">   mcrypt_generic_deinit($mcrypt);</div><div class="line">   mcrypt_module_close($mcrypt);</div><div class="line"></div><div class="line">   return gzuncompress($result);</div><div class="line">}</div></pre></td></tr></table></figure>
<p>&#x6B65;&#x9AA4;&#xFF1A;</p>
<ol>
<li>&#x6839;&#x636E;&#x52A0;&#x5BC6;&#x7B97;&#x6CD5;&#x548C;&#x52A0;&#x5BC6;&#x6A21;&#x5F0F;&#x83B7;&#x53D6;&#x6A21;&#x5757;</li>
<li>&#x521D;&#x59CB;&#x5316;&#x968F;&#x673A;&#x5411;&#x91CF;</li>
<li>&#x521D;&#x59CB;&#x5316;&#x52A0;&#x5BC6;&#x5668;</li>
<li>&#x89E3;&#x5BC6;&#x5BC6;</li>
<li>&#x91CA;&#x653E;&#x8D44;&#x6E90;</li>
<li>&#x5173;&#x95ED;&#x6A21;&#x5757;</li>
</ol>
<h2 id="&#x56FD;&#x9645;&#x5316;&#x548C;&#x591A;&#x8BED;&#x8A00;"><a href="#&#x56FD;&#x9645;&#x5316;&#x548C;&#x591A;&#x8BED;&#x8A00;" class="headerlink" title="&#x56FD;&#x9645;&#x5316;&#x548C;&#x591A;&#x8BED;&#x8A00;"></a>&#x56FD;&#x9645;&#x5316;&#x548C;&#x591A;&#x8BED;&#x8A00;</h2><p>&#x901A;&#x8FC7; <code>core_lang</code>&#x6765;&#x5E94;&#x5BF9;&#x591A;&#x8BED;&#x8A00;&#x6587;&#x672C;&#x7684;localization</p>
<p>wecenter&#x5E76;&#x672A;&#x9488;&#x5BF9;&#x7528;&#x6237;&#x63D0;&#x4F9B;&#x672C;&#x5730;&#x5316;&#x7684;&#x652F;&#x6301;&#xFF0C;&#x5982;&#x679C;&#x9700;&#x8981;&#x63D0;&#x4F9B;&#x57FA;&#x4E8E;&#x7528;&#x6237;&#x7684;&#xFF0C;&#x53EF;&#x4EE5;&#x7A0D;&#x52A0;&#x6539;&#x52A8;&#xFF0C;&#x6839;&#x636E;&#x6D4F;&#x89C8;&#x5668;&#x7684;&#x672C;&#x5730;&#x5316;&#x521D;&#x59CB;&#x5316;&#x8BED;&#x79CD;&#xFF0C;&#x81EA;&#x52A8;&#x9009;&#x62E9;&#x672C;&#x5730;&#x5316;&#x8D44;&#x6E90;&#x3002;</p>
<h3 id="&#x4F7F;&#x7528;-3"><a href="#&#x4F7F;&#x7528;-3" class="headerlink" title="&#x4F7F;&#x7528;"></a>&#x4F7F;&#x7528;</h3><p>&#x914D;&#x7F6E;</p>
<blockquote>
<p>language/en_US.php</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$language[&apos;&#x62B1;&#x6B49;, &#x4F60;&#x7684;&#x8D26;&#x53F7;&#x5DF2;&#x7ECF;&#x88AB;&#x7981;&#x6B62;&#x767B;&#x5F55;&apos;] = &apos;Sorry, your account has been suspended&apos;;</div></pre></td></tr></table></figure>
<p>&#x4F7F;&#x7528;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;th&gt;&lt;?php _e(&apos;&#x6587;&#x7AE0;&#x6807;&#x9898;&apos;); ?&gt;&lt;/th&gt;</div></pre></td></tr></table></figure>
<h3 id="&#x5404;&#x8BED;&#x79CD;&#x8D44;&#x6E90;&#x914D;&#x7F6E;"><a href="#&#x5404;&#x8BED;&#x79CD;&#x8D44;&#x6E90;&#x914D;&#x7F6E;" class="headerlink" title="&#x5404;&#x8BED;&#x79CD;&#x8D44;&#x6E90;&#x914D;&#x7F6E;"></a>&#x5404;&#x8BED;&#x79CD;&#x8D44;&#x6E90;&#x914D;&#x7F6E;</h3><p>&#x63D0;&#x4F9B;&#x4E86;&#x4E00;&#x4E2A;&#x5DE5;&#x5177;&#x51FD;&#x6570;&#xFF0C;&#x65B9;&#x4FBF;&#x4F7F;&#x7528;</p>
<blockquote>
<p>system/functions.inc.php</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">function _e($string, $replace = null)</div><div class="line">{</div><div class="line">	if (!class_exists(&apos;AWS_APP&apos;, false))</div><div class="line">	{</div><div class="line">		echo load_class(&apos;core_lang&apos;)-&gt;translate($string, $replace, TRUE);</div><div class="line">	}</div><div class="line">	else</div><div class="line">	{</div><div class="line">		echo AWS_APP::lang()-&gt;translate($string, $replace, TRUE);</div><div class="line">	}</div><div class="line">}</div></pre></td></tr></table></figure>
<p>&#x5C06;&#x5404;&#x56FD;&#x8BED;&#x8A00;&#x7684;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x653E;&#x5230; <code>language</code>&#x6587;&#x4EF6;&#x5939;&#x4E2D;<br>&#x901A;&#x8FC7;&#x7CFB;&#x7EDF;&#x8BBE;&#x7F6E;&#x7684;&#x8BED;&#x8A00;SYSTEM_LANG&#xFF0C;&#x6765;&#x52A0;&#x8F7D;&#x4E0D;&#x540C;&#x7684;&#x6587;&#x4EF6;&#xFF0C;&#x5B9E;&#x73B0;&#x672C;&#x5730;&#x5316;&#x3002;</p>
<blockquote>
<p>system/core/lang.php#__consturct</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">$language_file = ROOT_PATH . &apos;language/&apos; . SYSTEM_LANG . &apos;.php&apos;;</div><div class="line"></div><div class="line">if (file_exists($language_file))</div><div class="line">{</div><div class="line">	require $language_file;</div><div class="line">}</div></pre></td></tr></table></figure>
<blockquote>
<p>system/core/lang.php</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line">public function translate($string, $replace = null, $display = false)</div><div class="line">{</div><div class="line">	$search = &apos;%s&apos;;</div><div class="line"></div><div class="line">	if (is_array($replace))</div><div class="line">	{</div><div class="line">		$search = array();</div><div class="line"></div><div class="line">		for ($i=0; $i&lt;count($replace); $i++)</div><div class="line">		{</div><div class="line">			$search[] = &apos;%s&apos; . $i;</div><div class="line">		};</div><div class="line">	}</div><div class="line"></div><div class="line">	if ($translate = $this-&gt;lang[trim($string)])</div><div class="line">	{</div><div class="line">		if (isset($replace))</div><div class="line">		{</div><div class="line">			$translate = str_replace($search, $replace, $translate);</div><div class="line">		}</div><div class="line"></div><div class="line">		if (!$display)</div><div class="line">		{</div><div class="line">			return $translate;</div><div class="line">		}</div><div class="line"></div><div class="line">		echo $translate;</div><div class="line">	}</div><div class="line">	else</div><div class="line">	{</div><div class="line">		if (isset($replace))</div><div class="line">		{</div><div class="line">			$string = str_replace($search, $replace, $string);</div><div class="line">		}</div><div class="line"></div><div class="line">		return $string;</div><div class="line">	}</div><div class="line">}</div></pre></td></tr></table></figure>
<p>&#x5907;&#x6CE8;</p>
<ul>
<li>&#x6784;&#x9020;&#x67E5;&#x627E;&#x6570;&#x7EC4;</li>
<li>&#x5982;&#x679C;&#x627E;&#x4E0D;&#x5230;&#x914D;&#x7F6E;&#xFF0C;&#x76F4;&#x63A5;&#x8FD4;&#x56DE;key</li>
<li>&#x5982;&#x679C;&#x9700;&#x8981;&#x683C;&#x5F0F;&#x5316;&#xFF08;&#x66FF;&#x6362;&#xFF09;&#xFF0C;&#x6267;&#x884C;&#x66FF;&#x6362;</li>
<li>&#x5982;&#x679C;&#x9700;&#x8981;&#x663E;&#x793A;&#xFF0C;&#x76F4;&#x63A5;echo&#x5230;&#x8F93;&#x51FA;&#x6D41;</li>
</ul>
<h2 id="&#x5168;&#x5C40;&#x5F02;&#x5E38;&#x5904;&#x7406;"><a href="#&#x5168;&#x5C40;&#x5F02;&#x5E38;&#x5904;&#x7406;" class="headerlink" title="&#x5168;&#x5C40;&#x5F02;&#x5E38;&#x5904;&#x7406;"></a>&#x5168;&#x5C40;&#x5F02;&#x5E38;&#x5904;&#x7406;</h2><p>&#x901A;&#x8FC7;&#x8BBE;&#x7F6E;&#x5168;&#x5C40;&#x5F02;&#x5E38;&#x56DE;&#x8C03;&#xFF0C;&#x5C06;&#x9519;&#x8BEF;&#x5B9A;&#x5411;&#x5230;500&#x9875;&#x9762;</p>
<blockquote>
<p>system/aws_app.inc.php#init</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">set_exception_handler(array(&apos;AWS_APP&apos;, &apos;exception_handle&apos;));</div><div class="line"></div><div class="line">...</div><div class="line"></div><div class="line">public static function exception_handle($exception)</div><div class="line">{</div><div class="line">	$exception_message = &quot;Application error\n------\nMessage: &quot; . $exception-&gt;getMessage() . &quot;\nFile: &quot; . $exception-&gt;getFile() . &quot;\nLine: &quot; . $exception-&gt;getLine() . &quot;\n------\nBuild: &quot; . G_VERSION . &quot; &quot; . G_VERSION_BUILD . &quot;\nPHP Version: &quot; . PHP_VERSION . &quot;\nURI: &quot; . $_SERVER[&apos;REQUEST_URI&apos;] . &quot;\nUser Agent: &quot; . $_SERVER[&apos;HTTP_USER_AGENT&apos;] . &quot;\nAccept Language: &quot; . $_SERVER[&apos;HTTP_ACCEPT_LANGUAGE&apos;] . &quot;\nIP Address: &quot; . fetch_ip() . &quot;\n------\n&quot; . $exception-&gt;getTraceAsString();</div><div class="line"></div><div class="line">	show_error($exception_message, $exception-&gt;getMessage());</div><div class="line">}</div></pre></td></tr></table></figure>
<blockquote>
<p>system/functions.inc.php</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">function show_error($exception_message, $error_message = &apos;&apos;)</div><div class="line">{</div><div class="line">	@ob_end_clean();</div><div class="line"></div><div class="line">	if (get_setting(&apos;report_diagnostics&apos;) == &apos;Y&apos; AND class_exists(&apos;AWS_APP&apos;, false))</div><div class="line">	{</div><div class="line">		AWS_APP::mail()-&gt;send(&apos;wecenter_report@wecenter.com&apos;, &apos;[&apos; . G_VERSION . &apos;][&apos; . G_VERSION_BUILD . &apos;][&apos; . base_url() . &apos;]&apos; . $error_message, nl2br($exception_message), get_setting(&apos;site_name&apos;), &apos;WeCenter&apos;);</div><div class="line">	}</div><div class="line"></div><div class="line">	if (isset($_SERVER[&apos;SERVER_PROTOCOL&apos;]) AND strstr($_SERVER[&apos;SERVER_PROTOCOL&apos;], &apos;/1.0&apos;) !== false)</div><div class="line">	{</div><div class="line">		header(&quot;HTTP/1.0 500 Internal Server Error&quot;);</div><div class="line">	}</div><div class="line">	else</div><div class="line">	{</div><div class="line">		header(&quot;HTTP/1.1 500 Internal Server Error&quot;);</div><div class="line">	}</div><div class="line"></div><div class="line">	echo _show_error($exception_message);</div><div class="line">	exit;</div><div class="line">}</div></pre></td></tr></table></figure>
<p>&#x53D1;&#x751F;&#x672A;&#x5904;&#x7406;&#x5F02;&#x5E38;&#x65F6;&#x4F1A;&#x7ED9;wecenter&#x53D1;&#x90AE;&#x4EF6;&#xFF0C;&#x4E0D;&#x9700;&#x8981;&#x8FD9;&#x4E2A;&#x884C;&#x4E3A;&#x53EF;&#x4EE5;&#x5173;&#x95ED;&#x6389;<code>report_diagnostics</code>&#x8BBE;&#x7F6E;&#x9879;</p>
<h2 id="BBCode&#xFF08;Bulletin-Board-Code&#xFF09;"><a href="#BBCode&#xFF08;Bulletin-Board-Code&#xFF09;" class="headerlink" title="BBCode&#xFF08;Bulletin Board Code&#xFF09;"></a>BBCode&#xFF08;Bulletin Board Code&#xFF09;</h2><blockquote>
<p>&#x53C2;&#x7167;&#xFF1A;&#xFF3B;wikipedia: BBCode&#xFF3D;(<a href="https://zh.wikipedia.org/wiki/BBCode" target="_blank" rel="external">https://zh.wikipedia.org/wiki/BBCode</a>)</p>
</blockquote>
<h3 id="&#x4F7F;&#x7528;-4"><a href="#&#x4F7F;&#x7528;-4" class="headerlink" title="&#x4F7F;&#x7528;"></a>&#x4F7F;&#x7528;</h3><p>BBCode&#x5E76;&#x6CA1;&#x6709;&#x4E00;&#x4E2A;&#x5171;&#x540C;&#x7684;&#x6807;&#x51C6;&#xFF0C;&#x4F46;&#x4ECD;&#x7136;&#x6709;&#x4E00;&#x4E9B;&#x8BED;&#x6CD5;&#x56E0;&#x4E3A;&#x88AB;&#x5E7F;&#x6CDB;&#x91C7;&#x7528;&#x800C;&#x6210;&#x4E3A;&#x5171;&#x901A;&#x8BED;&#x6CD5;&#xFF1A;</p>
<ul>
<li>[b]&#x7C97;&#x9AD4;[/b]</li>
<li>[i]&#x659C;&#x9AD4;[/i]</li>
<li>[u]&#x5E95;&#x7DDA;[/u]</li>
<li>[url]<a href="http://wikipedia.org[/url" target="_blank" rel="external">http://wikipedia.org[/url</a>]</li>
<li>[url=<a href="http://wikipedia.org]Wikipedia[/url" target="_blank" rel="external">http://wikipedia.org]Wikipedia[/url</a>]</li>
<li>[img]<a href="http://upload.wikimedia.org/wikipedia/commons/thumb/6/63/Wikipedia-logo.png/72px-Wikipedia-logo.png[/img" target="_blank" rel="external">http://upload.wikimedia.org/wikipedia/commons/thumb/6/63/Wikipedia-logo.png/72px-Wikipedia-logo.png[/img</a>]</li>
<li>[quote]&#x5F15;&#x8A00;[/quote]</li>
<li>[code]Monospace&#x56FA;&#x5B9A;&#x5B57;&#x5143;&#x5BEC;&#x5EA6;[/code]</li>
<li>[size=24]&#x6587;&#x5B57;[/size]</li>
<li>[color=red]&#x7D05;&#x5B57;[/color]</li>
<li>[:-)]&#x6216;:smile:</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$article_info[&apos;message&apos;] = FORMAT::parse_attachs(nl2br(FORMAT::parse_bbcode($article_info[&apos;message&apos;])));</div></pre></td></tr></table></figure>
<h3 id="&#x5B9E;&#x73B0;-3"><a href="#&#x5B9E;&#x73B0;-3" class="headerlink" title="&#x5B9E;&#x73B0;"></a>&#x5B9E;&#x73B0;</h3><p>&#x53C2;&#x7167;FORMAT&#x7684;&#x5B9E;&#x73B0;</p>
<blockquote>
<p>system/class/cls_format.inc.php#parse_bbcode</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">public static function parse_bbcode($text)</div><div class="line">{</div><div class="line">	if (!$text)</div><div class="line">	{</div><div class="line">		return false;</div><div class="line">	}</div><div class="line"></div><div class="line">	return self::parse_links(load_class(&apos;Services_BBCode&apos;)-&gt;parse($text));</div><div class="line">}</div></pre></td></tr></table></figure>
<p><code>Services_BBCode</code>&#x5B8C;&#x6210;&#x4E86;BBCode&#x5230;html&#x7684;&#x8F6C;&#x6362;</p>
<blockquote>
<p>system/Services/BBCode.php</p>
</blockquote>
<p>2016.07 by haiyang@&#x676D;&#x5DDE;</p>

      
    </div>
    
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2016/08/12/decision-tree-implement-in-python-notes/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption"><</strong>
      <div class="article-nav-title">
        
          《决策树算法的Python实现》笔记
        
      </div>
    </a>
  
  
    <a href="/2016/08/12/stage-of-k12-education/" id="article-nav-older" class="article-nav-link-wrap">
      <div class="article-nav-title">关于K12教育类产品的现状和发展</div>
      <strong class="article-nav-caption">></strong>
    </a>
  
</nav>

  
</article>


<div class="share_jia">
	<!-- JiaThis Button BEGIN -->
	<div class="jiathis_style">
		<span class="jiathis_txt">Share to: &nbsp; </span>
		<a class="jiathis_button_facebook"></a> 
    <a class="jiathis_button_twitter"></a>
    <a class="jiathis_button_plus"></a> 
    <a class="jiathis_button_tsina"></a>
		<a class="jiathis_button_cqq"></a>
		<a class="jiathis_button_douban"></a>
		<a class="jiathis_button_weixin"></a>
		<a class="jiathis_button_tumblr"></a>
    <a href="http://www.jiathis.com/share" class="jiathis jiathis_txt jtico jtico_jiathis" target="_blank"></a>
	</div>
	<script type="text/javascript" src="https://dn-gitseassl.qbox.me/jiathis/code/jia.js?uid=1405949716054953" charset="utf-8"></script>
	<!-- JiaThis Button END -->
</div>






<div class="duoshuo">
	<!-- 多说评论框 start -->
	<div class="ds-thread" data-thread-key="the-notes-of-wecenter" data-title="wecenter学习笔记" data-url="http://yungoo.github.io/2016/08/12/the-notes-of-wecenter/"></div>
	<!-- 多说评论框 end -->
	<!-- 多说公共JS代码 start (一个网页只需插入一次) -->
	<script type="text/javascript">
	var duoshuoQuery = {short_name:"true"};
	(function() {
		var ds = document.createElement('script');
		ds.type = 'text/javascript';ds.async = true;
		ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
		ds.charset = 'UTF-8';
		(document.getElementsByTagName('head')[0] 
		 || document.getElementsByTagName('body')[0]).appendChild(ds);
	})();
	</script>
	<!-- 多说公共JS代码 end -->
</div>




</div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2016 haiyang
    	</div>
      	<div class="footer-right">
      		<a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/litten/hexo-theme-yilia" target="_blank">Yilia</a> by Litten
      	</div>
    </div>
  </div>
</footer>
    </div>
    
  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">


<script>
	var yiliaConfig = {
		fancybox: true,
		mathjax: true,
		animate: true,
		isHome: false,
		isPost: true,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false,
		root: ''
	}
</script>
<script src="https://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js"></script>
<script src="/js/main.js"></script>






<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


  </div>
</body>
</html>